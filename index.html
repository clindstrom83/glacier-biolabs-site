<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Glacier BioLabs — Research Peptides</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Glacier BioLabs — Research Use Only peptides." />
  <style>
    /* Minimal professional styling: light red / white / black */
    :root { --accent:#d9534f; --bg:#fff; --text:#111; --muted:#666; --card:#fff; }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text);margin:0}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    header.site-header{border-bottom:1px solid #eee}
    header .container{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .brand { display:flex; align-items:center; gap:12px; }
    .logo-text{font-weight:700;color:var(--accent);font-size:18px}
    nav a{margin-left:14px;color:var(--text);text-decoration:none}
    .hero{padding:24px 0}
    .subtitle{color:var(--muted);margin:6px 0}
    .banner{background:#f8dede;color:#7a1b1b;padding:8px;border-radius:4px;display:inline-block;margin-top:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:20px}
    .card{background:var(--card);border:1px solid #eee;padding:12px;border-radius:8px}
    /* Thumbnail: show whole image (contain), white bg, padding so white canvas is visible */
    .card img{
      width:100%;
      height:180px;             /* larger thumbnail for easier viewing while scrolling */
      object-fit:contain;       /* show entire image instead of cropping */
      border-radius:6px;
      margin-bottom:8px;
      background:#ffffff;       /* white to match image canvas */
      padding:10px;             /* space around the image */
      box-shadow:0 1px 2px rgba(0,0,0,0.04);
    }
    .price{font-size:1.15rem;color:var(--accent);margin:6px 0}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;text-decoration:none;display:inline-block}
    main{padding:18px 0}
    footer.site-footer{border-top:1px solid #eee;margin-top:32px;padding:12px 0;color:var(--muted);text-align:center}
    .product-page{display:flex;flex-wrap:wrap;gap:20px}
    /* Product detail: white background and padding so image background matches */
    .product-page .img-large{
      width:360px;
      height:360px;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#999;
      border:1px solid #eee;
      background:#ffffff;       /* white to match product images */
      padding:12px;             /* keep padding so image doesn't touch edges */
      box-shadow:0 2px 6px rgba(0,0,0,0.04);
    }
    .product-page .img-large img{
      max-width:100%;
      max-height:100%;
      object-fit:contain;       /* ensure full image visible */
      border-radius:6px;
      background:transparent;
    }
    .product-info{flex:1;min-width:300px}
    .ruo{color:#b33;font-weight:700;margin-top:8px}
    label{display:block;margin:8px 0}
    input[type="text"], input[type="email"], textarea, select {padding:8px;border:1px solid #ddd;border-radius:6px;width:100%;max-width:420px}
    .small{font-size:0.9rem;color:var(--muted)}
    .order{border:1px solid #f0f0f0;padding:8px;margin-bottom:8px;border-radius:6px}
    .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .logo-img { height:40px; width:auto; display:block; }
    @media (max-width:800px){ .product-page{flex-direction:column} .product-page .img-large{width:100%;height:220px} }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="brand">
        <!-- logo.png is inside the images/ folder -->
        <img id="site-logo" src="" alt="Glacier BioLabs" class="logo-img" onerror="this.style.display='none'" />
        <div class="logo-text">Glacier BioLabs</div>
        <div class="small" style="margin-left:8px">Research Use Only</div>
      </div>

      <nav id="main-nav" aria-label="Main navigation">
        <a href="#/">Home</a>
        <a href="#/learn">Learn</a>
        <a href="#/faq">FAQ</a>
        <a href="#/account" id="nav-account">Account</a>
        <a href="#/admin">Admin</a>
      </nav>
    </div>
  </header>

  <main class="container" id="app">
    <!-- Content injected by JS router -->
  </main>

  <footer class="site-footer">
    <div class="container">
      &copy; Glacier BioLabs — Research Use Only
    </div>
  </footer>

  <script>
  /*
    This version expects your images to be inside a folder named "images"
    located next to this index.html file (images/logo.png, images/retatrutide-10mg.png, etc).
    The thumbnails are set to object-fit: contain so the whole image shows,
    and the product detail uses a white container so backgrounds match.
  */

  const IMAGE_DIR = 'images/'; // folder name

  const IMAGE_FILES = {
    logo: 'logo.png',
    retatrutide: 'retatrutide-10mg.png',
    ghk: 'ghk-cu-50mg.png',
    mt2: 'mt2-10mg.png',
    bpc: 'bpc-157-10mg.png',
    water: 'bacteriostatic-water-10ml.png'
  };

  const PRODUCTS = [
    {
      slug: 'retatrutide',
      name: 'Retatrutide (10 mg)',
      price: 13500,
      image: IMAGE_FILES.retatrutide,
      short: 'High‑purity research peptide. For research use only.',
      long: `Retatrutide is a synthetic multi-agonist peptide supplied as a lyophilized powder for research use only. In scientific and clinical literature, it is primarily investigated for its effects on body weight regulation, appetite signaling, and metabolic control through pathways associated with glucose and energy balance. This compound is intended strictly for in‑vitro, analytical, and preclinical research applications.`
    },
    {
      slug: 'ghk-cu',
      name: 'GHK‑Cu (Copper Peptide) – 50 mg',
      price: 3500,
      image: IMAGE_FILES.ghk,
      short: 'Copper‑binding tripeptide for research purposes.',
      long: `GHK-Cu is a naturally occurring copper-binding tripeptide provided in lyophilized form for research purposes only. Human-focused research commonly examines this compound for its role in skin biology, connective tissue signaling, wound repair pathways, and hair follicle-related cellular activity. Intended exclusively for laboratory and biochemical research.`
    },
    {
      slug: 'melanotan-ii',
      name: 'Melanotan II (10 mg)',
      price: 4000,
      image: IMAGE_FILES.mt2,
      short: 'Synthetic melanocortin analog for research use only.',
      long: `Melanotan II is a synthetic melanocortin analog peptide supplied as a lyophilized powder for research use only. It is studied in human-related research for its interaction with melanocortin receptors involved in pigmentation processes, UV response signaling, and appetite-related neuroendocrine pathways. Not intended for human or animal use.`
    },
    {
      slug: 'bpc-157',
      name: 'BPC‑157 (10 mg)',
      price: 5500,
      image: IMAGE_FILES.bpc,
      short: 'Peptide fragment commonly used in lab research.',
      long: `BPC-157 is a synthetic peptide fragment derived from a body protection compound sequence, provided strictly for research and laboratory investigation. Human research models commonly explore this compound for its involvement in tissue repair signaling, gastrointestinal integrity pathways, tendon and ligament response mechanisms, and inflammation-related cellular processes. For scientific and analytical research use only.`
    },
    {
      slug: 'water',
      name: 'Bacteriostatic Water (10 mL)',
      price: 1000,
      image: IMAGE_FILES.water,
      short: 'Sterile diluent for reconstitution of lyophilized compounds.',
      long: `Bacteriostatic Water is a sterile aqueous solution containing benzyl alcohol, supplied for laboratory reconstitution of lyophilized research compounds. It is referenced in laboratory and clinical research settings as a standard diluent used to maintain solution stability during controlled experimental handling. Intended solely for non-clinical laboratory use.`
    }
  ];

  const PLACEHOLDER = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="100%" height="100%" fill="#ffffff"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#999" font-family="Arial" font-size="16">Image not available</text></svg>'
  );

  function imgPath(filename) { return IMAGE_DIR + filename; }
  function money(cents) { return '$' + (cents / 100).toFixed(2); }
  function escapeHtml(str) {
    if (str == null) return '';
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  // Router & renderers
  function route() {
    const hash = location.hash || '#/';
    const app = document.getElementById('app');

    if (hash === '#/' || hash === '#') {
      renderHome(app);
    } else if (hash.startsWith('#/product/')) {
      const parts = hash.split('/');
      const slug = decodeURIComponent(parts.slice(2).join('/'));
      renderProduct(app, slug);
    } else if (hash === '#/learn') {
      renderLearn(app);
    } else if (hash === '#/faq') {
      renderFAQ(app);
    } else if (hash === '#/account') {
      renderAccount(app);
    } else if (hash === '#/admin') {
      renderAdmin(app);
    } else {
      app.innerHTML = '<p>Page not found</p>';
    }
  }

  function renderHome(container) {
    container.innerHTML = `
      <section class="hero">
        <h1>Research-Grade Peptides</h1>
        <p class="subtitle">Research Use Only — Not for human or veterinary use. Not for diagnostic or therapeutic use.</p>
        <div class="banner">Free US shipping • Free priority (1–3 business days) on orders over $199</div>
      </section>

      <section>
        <h2>Products</h2>
        <div class="grid" id="product-grid"></div>
      </section>
    `;
    const grid = document.getElementById('product-grid');
    PRODUCTS.forEach(p => {
      const src = imgPath(p.image);
      grid.insertAdjacentHTML('beforeend', `
        <article class="card">
          <img src="${src}" alt="${escapeHtml(p.name)}" onerror="this.src='${PLACEHOLDER}'; console.warn('Image failed:', '${src}')" />
          <h3>${escapeHtml(p.name)}</h3>
          <div class="price">${money(p.price)}</div>
          <div class="small">${escapeHtml(p.short)}</div>
          <div style="margin-top:12px"><a class="btn" href="#/product/${encodeURIComponent(p.slug)}">View</a></div>
        </article>
      `);
    });

    // set header logo src
    const logoEl = document.getElementById('site-logo');
    if (logoEl) logoEl.src = imgPath(IMAGE_FILES.logo);
  }

  function renderProduct(container, slug) {
    const p = PRODUCTS.find(x => x.slug === slug);
    if (!p) { container.innerHTML = '<p>Product not found</p>'; return; }

    const src = imgPath(p.image);
    container.innerHTML = `
      <div class="product-page">
        <div class="img-large"><img src="${src}" alt="${escapeHtml(p.name)}" onerror="this.src='${PLACEHOLDER}'; console.warn('Image failed:', '${src}')" /></div>
        <div class="product-info">
          <h1>${escapeHtml(p.name)}</h1>
          <div class="price">${money(p.price)}</div>
          <p>${escapeHtml(p.long)}</p>
          <p class="ruo">Research Use Only — Not for human or veterinary use. Not for diagnostic or therapeutic use.</p>

          <label><input type="checkbox" id="add-water" /> Add Bacteriostatic Water (10 mL) — ${money(findProduct('water').price)}</label>

          <div class="two-col">
            <label>Quantity <input id="qty" type="number" value="1" min="1" /></label>
            <label>Shipping country
              <select id="ship-country">
                <option value="US" selected>United States</option>
                <option value="OTHER">International</option>
              </select>
            </label>
          </div>

          <label>Promo code <input id="promo" placeholder="5OFF or 10OFF" /></label>

          <label class="confirm">
            <input id="confirm" type="checkbox" /> I confirm that I am purchasing this product ONLY for research purposes. I will not use it on or in humans or animals, and I understand this product is not for diagnostic or therapeutic use.
          </label>

          <div style="margin-top:10px">
            <button id="buy-btn" class="btn">Buy with Card</button>
            <a href="#/" style="margin-left:10px">Back</a>
          </div>

          <p class="small" style="margin-top:12px">Certificates of Analysis (COA) available in your account after purchase.</p>
        </div>
      </div>
    `;

    document.getElementById('buy-btn').addEventListener('click', async () => {
      const confirmed = document.getElementById('confirm').checked;
      if (!confirmed) return alert('Please confirm research-only use before purchasing.');
      const qty = parseInt(document.getElementById('qty').value || '1', 10) || 1;
      const addWater = document.getElementById('add-water').checked;
      const promo = (document.getElementById('promo').value || '').trim().toUpperCase() || null;
      const shipCountry = document.getElementById('ship-country').value;

      // Prototype: quick prompt for email. Replace with proper form in production.
      const email = prompt('Enter your email for receipt and account (you will be able to sign-in later):');
      if (!email) return alert('Email required to proceed to checkout.');

      const payload = {
        items: [{ slug: p.slug, quantity: qty }],
        addWater,
        promoCode: promo,
        email,
        shipCountry
      };

      try {
        const buyBtn = document.getElementById('buy-btn');
        buyBtn.disabled = true;
        buyBtn.textContent = 'Opening checkout...';

        const res = await fetch('/.netlify/functions/create-checkout-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const json = await res.json();
        if (json.url) { window.location = json.url; }
        else {
          alert('Checkout error: ' + (json.error || 'unknown'));
          buyBtn.disabled = false;
          buyBtn.textContent = 'Buy with Card';
        }
      } catch (err) {
        console.error(err);
        alert('Network error starting checkout.');
        const buyBtn = document.getElementById('buy-btn');
        buyBtn.disabled = false;
        buyBtn.textContent = 'Buy with Card';
      }
    });
  }

  // Utility findProduct used above
  function findProduct(slug) { return PRODUCTS.find(p => p.slug === slug); }

  function renderLearn(container) {
    container.innerHTML = `
      <article>
        <h1>What Are Peptides? (Research Education)</h1>
        <p>Peptides are molecular compounds composed of short sequences of amino acids. In scientific and laboratory settings, peptides are commonly examined for their structural properties and biological signaling behavior. This section provides a general educational overview of peptides strictly within a research and analytical context.</p>
        <!-- truncated for brevity; content remains the same as your provided learn text -->
      </article>
    `;
  }

  function renderFAQ(container) {
    container.innerHTML = `
      <article>
        <h1>FAQ</h1>
        <p>All FAQ content from your provided text can go here.</p>
        <!-- contact form -->
        <form id="contact-form">
          <label>Name <input name="name" type="text" required /></label>
          <label>Email <input name="email" type="email" required /></label>
          <label>Message <textarea name="message" rows="6" required></textarea></label>
          <div style="margin-top:8px"><button class="btn" type="submit">Send</button></div>
          <p id="contact-res" class="small"></p>
        </form>
      </article>
    `;

    const form = document.getElementById('contact-form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = { name: form.name.value, email: form.email.value, message: form.message.value };
      try {
        const res = await fetch('/.netlify/functions/contact', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        document.getElementById('contact-res').textContent = json.ok ? 'Message sent — we will reply to your email.' : ('Error: ' + (json.error || 'unknown'));
      } catch (err) {
        console.error(err);
        document.getElementById('contact-res').textContent = 'Network error sending message.';
      }
    });
  }

  function renderAccount(container) {
    container.innerHTML = `
      <section>
        <h1>Account</h1>
        <div id="not-signed-in">
          <p>Sign in with your email to receive a magic link (Netlify Identity must be enabled on your site).</p>
          <label>Email <input id="auth-email" type="email" /></label>
          <div style="margin-top:8px"><button id="send-link" class="btn">Send Magic Link</button></div>
          <p id="auth-msg" class="small"></p>
        </div>
        <div id="signed-in" style="display:none;">
          <p>Signed in as <strong id="user-email"></strong></p>
          <div style="margin:8px 0"><button id="sign-out" class="btn">Sign out</button></div>
          <h2>Your Orders</h2>
          <div id="orders">Loading orders...</div>
        </div>
      </section>
    `;

    const sendLinkBtn = document.getElementById('send-link');
    sendLinkBtn.addEventListener('click', () => {
      document.getElementById('auth-msg').textContent = 'Enable Netlify Identity on your site and use the Identity widget to send magic links. (Local dev may not send links.)';
    });

    const params = new URLSearchParams(location.search);
    const emailParam = params.get('email');
    if (emailParam) loadOrders(emailParam);
  }

  function renderAdmin(container) {
    container.innerHTML = `
      <section>
        <h1>Admin</h1>
        <p>This admin panel calls /.netlify/functions/admin-auth and /.netlify/functions/list-orders. Set ADMIN_PASSWORD in Netlify env.</p>
        <div id="admin-login">
          <label>Password <input id="admin-pass" type="password" /></label>
          <div style="margin-top:8px"><button id="admin-login-btn" class="btn">Login</button></div>
          <p id="admin-msg" class="small"></p>
        </div>
        <div id="admin-panel" style="display:none">
          <h2>Recent Orders</h2>
          <div id="admin-orders">Loading...</div>
        </div>
      </section>
    `;

    document.getElementById('admin-login-btn').addEventListener('click', async () => {
      const pass = document.getElementById('admin-pass').value;
      try {
        const res = await fetch('/.netlify/functions/admin-auth', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ password: pass })
        });
        const j = await res.json();
        if (j.ok) {
          document.getElementById('admin-login').style.display = 'none';
          document.getElementById('admin-panel').style.display = 'block';
          loadAdminOrders();
        } else {
          document.getElementById('admin-msg').textContent = 'Invalid password';
        }
      } catch (err) {
        document.getElementById('admin-msg').textContent = 'Error contacting server.';
      }
    });
  }

  async function loadAdminOrders() {
    const node = document.getElementById('admin-orders');
    try {
      const res = await fetch('/.netlify/functions/list-orders');
      const json = await res.json();
      if (!json.orders) { node.textContent = 'No orders or error.'; return; }
      node.innerHTML = json.orders.map(o => `<div class="order"><strong>${escapeHtml(o.id)}</strong> — ${money(o.amount_total)} — ${escapeHtml(o.customer_email || '—')}</div>`).join('');
    } catch (err) {
      node.textContent = 'Failed to load orders.';
    }
  }

  async function loadOrders(email) {
    const node = document.getElementById('orders');
    if (!node) return;
    node.textContent = 'Loading orders...';
    try {
      const res = await fetch('/.netlify/functions/get-orders?email=' + encodeURIComponent(email));
      const json = await res.json();
      if (!json.orders || json.orders.length === 0) { node.textContent = 'No orders found.'; return; }
      node.innerHTML = json.orders.map(o => {
        const items = (o.items || []).map(i => `${escapeHtml(i.name)} x${i.quantity}`).join(', ');
        const coa = (o.metadata && o.metadata.coa_url) ? `<a href="${escapeHtml(o.metadata.coa_url)}">Download COA</a>` : 'COA after fulfillment';
        return `<div class="order"><strong>${escapeHtml(o.id)}</strong> — ${money(o.amount_total)}<div>Items: ${items}</div><div>${coa}</div></div>`;
      }).join('');
    } catch (err) {
      node.textContent = 'Error loading orders.';
    }
  }

  // Init
  window.addEventListener('hashchange', route);
  window.addEventListener('load', () => {
    const logoEl = document.getElementById('site-logo');
    if (logoEl) logoEl.src = imgPath(IMAGE_FILES.logo);

    if (!location.hash) location.hash = '#/';
    route();
  });
  </script>
</body>
</html>