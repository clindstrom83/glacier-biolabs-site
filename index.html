<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Glacier BioLabs â€” Research Peptides</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Glacier BioLabs â€” Research Use Only compounds." />
  <style>
    :root{
      --accent:#d0352c;           /* primary red */
      --accent-2:#b12a24;         /* darker red */
      --accent-soft: rgba(208,53,44,.10);
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#ffffff;
      --card:#ffffff;
      --shadow: 0 10px 25px rgba(2,6,23,.08);
      --radius: 14px;
      --radius-sm: 10px;
      --max: 1180px;

      --topbar-h: 36px;
      --header-h: 72px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--ink);
    }
    a{color:inherit;text-decoration:none}
    button,input,select,textarea{font:inherit}

    .wrap{max-width:var(--max); margin:0 auto; padding:0 16px}
    .muted{color:var(--muted)}
    .sr-only{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}

    /* ===== Topbar + Header ===== */
    .topbar{
      height:var(--topbar-h);
      background:var(--accent-2);
      color:#fff;
      display:flex;
      align-items:center;
      font-size:13px;
    }
    .topbar .wrap{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .topbar .right{
      display:flex; gap:14px; align-items:center;
      opacity:.95;
    }
    .topbar a{color:#fff; opacity:.95}
    .topbar a:hover{opacity:1; text-decoration:underline}

    header{
      position:sticky;
      top:0;
      z-index:50;
      background:#fff;
      border-bottom:1px solid var(--line);
    }
    .header{
      height:var(--header-h);
      display:flex;
      align-items:center;
      gap:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 220px;
    }
    .logo{
      height:40px;width:auto; display:block;
    }
    .brand-text{
      display:flex; flex-direction:column; line-height:1.05;
    }
    .brand-text strong{font-size:15px; letter-spacing:.2px}
    .brand-text span{font-size:12px; color:var(--muted)}

    nav.desktop-nav{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      font-weight:600;
      font-size:14px;
    }
    nav.desktop-nav a{
      padding:10px 8px;
      border-radius:10px;
    }
    nav.desktop-nav a:hover{background:rgba(2,6,23,.04)}
    nav.desktop-nav a.active{
      color:var(--accent-2);
      background:var(--accent-soft);
    }

    .search{
      display:flex; align-items:center; gap:0;
      width: 360px;
      max-width: 38vw;
    }
    .search input{
      width:100%;
      border:1px solid var(--line);
      border-right:none;
      padding:11px 12px;
      border-radius:999px 0 0 999px;
      outline:none;
    }
    .search input:focus{
      border-color: rgba(208,53,44,.45);
      box-shadow: 0 0 0 4px rgba(208,53,44,.12);
    }
    .search button{
      border:1px solid var(--line);
      background:var(--accent);
      color:#fff;
      padding:11px 14px;
      border-radius:0 999px 999px 0;
      cursor:pointer;
      font-weight:700;
    }
    .search button:hover{background:var(--accent-2)}

    .header-actions{
      display:flex; align-items:center; gap:10px;
    }

    .cart-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      font-weight:700;
      font-size:13px;
      background:#fff;
      cursor:pointer;
    }
    .cart-pill:hover{box-shadow:0 6px 16px rgba(2,6,23,.08)}
    /* cart bump animation */
    .bump {
      transform: scale(1.06);
      transition: transform .12s ease;
    }

    /* toast */
    #gl-toast {
      position:fixed;
      right:18px;
      bottom:88px;
      z-index:120;
      min-width:180px;
      max-width:360px;
      display:flex;
      flex-direction:column;
      gap:8px;
      pointer-events:none;
    }
    .gl-toast-item {
      pointer-events:auto;
      background:#0f172a;
      color:#fff;
      padding:10px 12px;
      border-radius:10px;
      box-shadow:0 10px 30px rgba(2,6,23,.18);
      font-weight:700;
      opacity:0.98;
    }

    /* ===== Mobile controls ===== */
    .hamburger{
      display:none;
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:10px 12px;
      cursor:pointer;
    }

    .drawer-backdrop{
      position:fixed; inset:0;
      background:rgba(2,6,23,.55);
      display:none;
      z-index:60;
    }
    .drawer{
      position:fixed; top:0; right:0;
      height:100%;
      width:min(420px, 92vw);
      background:#fff;
      z-index:70;
      transform:translateX(100%);
      transition:transform .25s ease;
      display:flex;
      flex-direction:column;
    }
    .drawer.open{transform:translateX(0)}
    .drawer .head{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
    }
    .drawer .body{padding:16px; display:flex; flex-direction:column; gap:8px}
    .drawer .body a{
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      font-weight:700;
    }
    .drawer .body a:hover{background:rgba(2,6,23,.03)}
    .drawer .close{
      border:1px solid var(--line);
      background:#fff;
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:800;
    }

    /* ===== Hero ===== */
    .hero{
      position:relative;
      overflow:hidden;
      border-bottom:1px solid var(--line);
      background:
        radial-gradient(1200px 500px at 20% 30%, rgba(208,53,44,.35), transparent 55%),
        radial-gradient(1000px 500px at 75% 30%, rgba(2,6,23,.18), transparent 60%),
        linear-gradient(135deg, rgba(2,6,23,.75), rgba(2,6,23,.45));
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background:
        url("images/hero.jpg") center/cover no-repeat;
      opacity:.22;
      filter:saturate(1.1) contrast(1.05);
    }
    .hero .wrap{
      position:relative;
      padding:56px 16px 48px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      align-items:center;
      gap:26px;
    }
    .hero h1{
      margin:0;
      color:#fff;
      font-size:42px;
      letter-spacing:.4px;
    }
    .hero p{
      margin:10px 0 0;
      color:rgba(255,255,255,.88);
      font-size:16px;
      max-width: 56ch;
      line-height:1.45;
    }
    .hero .kicker{
      display:inline-flex;
      gap:10px; align-items:center;
      color:rgba(255,255,255,.85);
      font-weight:800;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:12px;
      margin-bottom:10px;
    }
    .hero .cta-row{
      margin-top:18px;
      display:flex; gap:12px; flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:10px;
      padding:12px 16px;
      border-radius:999px;
      border:1px solid transparent;
      font-weight:800;
      cursor:pointer;
      white-space:nowrap;
    }
    .btn.primary{
      background:var(--accent);
      color:#fff;
      box-shadow:0 14px 30px rgba(208,53,44,.28);
    }
    .btn.primary:hover{background:var(--accent-2)}
    .btn.ghost{
      background:transparent;
      border-color:rgba(255,255,255,.25);
      color:#fff;
    }
    .btn.ghost:hover{background:rgba(255,255,255,.08)}
    .hero .badge{
      display:inline-flex;
      align-items:center;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.12);
      color:#fff;
      border:1px solid rgba(255,255,255,.18);
      font-weight:700;
      margin-top:14px;
    }
    .hero .panel{
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      border-radius: var(--radius);
      padding:16px;
      backdrop-filter: blur(6px);
      color:#fff;
    }
    .hero .panel strong{display:block; font-size:14px; letter-spacing:.2px}
    .hero .panel small{display:block; opacity:.88; margin-top:6px; line-height:1.35}

    /* ===== Page sections ===== */
    main{padding:24px 0 0}
    .section{padding:26px 0}
    .section h2{
      margin:0 0 14px;
      font-size:26px;
      letter-spacing:.3px;
    }
    .subhead{
      margin:-8px 0 18px;
      color:var(--muted);
      line-height:1.45;
      max-width: 70ch;
    }
    .divider{height:1px; background:var(--line); margin:20px 0}

    /* ===== Catalog layout ===== */
    .catalog{
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:26px;
      align-items:start;
    }
    aside.filters{
      border-right:1px solid var(--line);
      padding-right:18px;
    }
    .filter-block{padding:6px 0 16px}
    .filter-block h3{
      margin:0 0 10px;
      font-size:16px;
      letter-spacing:.2px;
    }
    .filter-line{height:1px; background:var(--line); margin:10px 0 14px}
    .check{
      display:flex; align-items:center; gap:10px;
      padding:10px 0;
      cursor:pointer;
      user-select:none;
      font-weight:600;
      color:var(--ink);
    }
    .check input{width:18px;height:18px}
    .chip{
      display:inline-flex; align-items:center;
      font-size:12px;
      font-weight:800;
      border-radius:999px;
      padding:4px 8px;
      background:rgba(2,6,23,.05);
      margin-left:auto;
      color:var(--muted);
    }
    .price-range{
      display:flex; gap:10px; align-items:center;
      flex-wrap:wrap;
    }
    .price-range input{
      width:120px;
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius:12px;
    }
    .price-range button{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:800;
      cursor:pointer;
    }
    .price-range button:hover{box-shadow:0 10px 22px rgba(2,6,23,.08)}

    .catalog-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .catalog-head .count{
      font-weight:700;
      color:var(--muted);
    }
    .sort{
      display:flex; align-items:center; gap:10px;
    }
    .sort select{
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      font-weight:700;
    }

    /* ===== Product cards ===== */
    .grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0,1fr));
      gap:18px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      transition:transform .14s ease, box-shadow .14s ease;
    }
    .card:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    .card .img-wrap{
      position:relative;
      background:#fff;
      border-bottom:1px solid var(--line);
      padding:12px;
    }
    .card .img-topbar{
      position:absolute; left:0; top:0; right:0;
      height:6px;
      background:var(--accent);
      opacity:.95;
    }
    .card img{
      width:100%;
      height:170px;
      object-fit:contain;
      background:#fff;
      border-radius:12px;
      display:block;
    }
    .tag-sale{
      position:absolute;
      left:12px; top:14px;
      background:var(--accent);
      color:#fff;
      font-weight:900;
      font-size:12px;
      padding:8px 10px;
      border-radius:12px;
      box-shadow:0 12px 24px rgba(208,53,44,.25);
    }
    .card .body{
      padding:14px 14px 16px;
    }
    .card h3{
      margin:0;
      font-size:15px;
      line-height:1.25;
      letter-spacing:.2px;
      min-height: 38px;
    }
    .stars{
      display:flex; align-items:center; justify-content:center;
      gap:2px;
      margin:10px 0 6px;
      color: var(--accent-2);
      font-weight:900;
      font-size:12px;
      letter-spacing:.05em;
    }
    .price{
      text-align:center;
      font-weight:900;
      color: var(--accent-2);
      margin:6px 0 10px;
      font-size:15px;
    }
    .card .small{
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
      min-height: 36px;
    }
    .card .actions{
      margin-top:12px;
      display:flex; justify-content:space-between; gap:8px;
    }

    /* small variant: tighter padding, less rounded (prevents pill button from appearing clipped) */
    .btn.small{
      padding:8px 12px;
      font-size:13px;
      border-radius:12px; /* override 999px for compact buttons */
    }
    .card .actions .btn{
      flex:1;
      min-width:0;
    }
    .card .actions .btn + .btn{ margin-left:8px; }

    /* ===== Product detail page =====
       UPDATED: keep colors identical but change layout to a clean left gallery + right info
    */
    .crumbs{
      font-size:13px;
      color:var(--muted);
      margin:6px 0 16px;
    }
    .product-page{
      display:grid;
      grid-template-columns: 520px 1fr;
      gap:26px;
      align-items:start;
      padding-bottom: 12px;
    }
    .media{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:14px;
      background:#fff;
    }
    .media .img-topbar{height:6px;background:var(--accent);border-radius:999px;margin-bottom:12px}
    .media img{
      width:100%;
      height:420px;
      object-fit:contain;
      display:block;
      background:#fff;
      border-radius:12px;
    }
    .pinfo h1{margin:0; font-size:34px; letter-spacing:.3px}
    .pinfo .rating-row{
      display:flex; align-items:center; gap:10px;
      margin:10px 0 10px;
      color:var(--muted);
      font-weight:700;
      font-size:14px;
      flex-wrap:wrap;
    }
    .pinfo .big-price{
      font-size:34px;
      font-weight:950;
      color:var(--accent-2);
      margin:10px 0 12px;
    }
    .pinfo .desc{color:var(--ink); line-height:1.5}
    .ruo{
      margin-top:14px;
      padding:12px 12px;
      border-radius:12px;
      background: var(--accent-soft);
      border:1px solid rgba(208,53,44,.18);
      color: var(--accent-2);
      font-weight:900;
      line-height:1.35;
      font-size:13px;
    }
    .form{
      margin-top:14px;
      display:grid;
      gap:12px;
    }
    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .field label{
      display:block;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
      margin-bottom:6px;
    }
    .field input, .field select, .field textarea{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      outline:none;
    }
    .field input:focus, .field select:focus, .field textarea:focus{
      border-color: rgba(208,53,44,.45);
      box-shadow: 0 0 0 4px rgba(208,53,44,.12);
    }
    .confirm{
      display:flex; gap:10px; align-items:flex-start;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      font-weight:700;
      color:var(--ink);
      line-height:1.35;
    }
    .confirm input{width:18px;height:18px;margin-top:2px}
    .cta-bar{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
      margin-top:8px;
    }
    .backlink{color:var(--muted); font-weight:800}
    .backlink:hover{color:var(--ink)}

    /* ===== Trust icons section ===== */
    .trust{
      border-top:1px solid var(--line);
      border-bottom:1px solid var(--line);
      background:#fff;
    }
    .trust .wrap{padding:28px 16px}
    .trust h2{
      text-align:center;
      margin:0 0 18px;
      letter-spacing:.4px;
    }
    .trust-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:16px;
      align-items:start;
      text-align:center;
    }
    .trust-card{
      padding:14px 12px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background:#fff;
    }
    .icon{
      width:66px;height:66px;
      border-radius:18px;
      border:2px solid var(--accent);
      display:flex;align-items:center;justify-content:center;
      margin:0 auto 10px;
      background: rgba(208,53,44,.06);
      font-weight:950;
      color:var(--accent-2);
    }
    .trust-card h3{margin:0 0 6px; font-size:15px; letter-spacing:.2px}
    .trust-card p{margin:0; color:var(--muted); line-height:1.45; font-size:13px}

    /* ===== Cart drawer (simple) ===== */
    .cart-drawer{
      position:fixed; right:18px; top:88px; width:340px; max-width:92vw;
      background:#fff; border:1px solid var(--line); border-radius:12px; box-shadow:var(--shadow);
      z-index:80; padding:12px; display:none; flex-direction:column; gap:8px;
    }
    .cart-drawer.open{display:flex}
    .cart-item{display:flex; gap:10px; align-items:center; justify-content:space-between}
    .cart-item .meta{flex:1}
    .cart-item .meta h4{margin:0;font-size:14px}
    .cart-item .meta p{margin:4px 0 0;font-size:13px;color:var(--muted)}
    .cart-total{font-weight:900;text-align:right;margin-top:8px}
    .cart-empty{color:var(--muted);text-align:center;padding:14px 0}

    /* ===== Footer policies links ===== */
    .policies{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;padding:14px 0 8px;background:#0b0f19;color:rgba(255,255,255,.8)}
    .policies a{color:rgba(255,255,255,.9);font-weight:700}

    /* ===== Improved product-page checkout button (new) ===== */
    .product-page { gap: 30px; }
    .pinfo { display:flex; flex-direction:column; gap:12px; }
    .pinfo .big-price { font-size:36px; font-weight:950; color:var(--accent-2); margin:4px 0 8px; }
    .order-row{ display:flex; gap:12px; align-items:center; }
    .order-row .field{ flex:1; margin:0; }
    .btn.primary.full { width:100%; padding:14px 16px; font-size:16px; border-radius:12px; }
    .order-help{ color:var(--muted); font-size:13px; margin-top:8px; }
    @media (max-width:900px){
      .order-row{ flex-direction:column; align-items:stretch; }
    }

    /* ===== Responsive ===== */
    @media (max-width: 1100px){
      .grid{grid-template-columns: repeat(3, minmax(0,1fr))}
    }
    @media (max-width: 900px){
      .search{display:none}
      nav.desktop-nav{display:none}
      .hamburger{display:inline-flex}
      .brand{min-width: unset}
      .hero .wrap{grid-template-columns: 1fr; padding:42px 16px 36px}
      .hero h1{font-size:34px}
      .catalog{grid-template-columns: 1fr}
      aside.filters{display:none}
      .grid{grid-template-columns: repeat(2, minmax(0,1fr))}
      .product-page{grid-template-columns: 1fr}
      .media img{height:320px}
      .trust-grid{grid-template-columns:1fr}
      .nl-form{grid-template-columns:1fr}
      .float-offer{display:none}
      .cart-drawer{right:10px; left:10px; top:auto; bottom:16px}
    }
    @media (max-width: 430px){
      .header{gap:10px}
      .brand-text strong{font-size:14px}
      .hero h1{font-size:30px}
      .grid{gap:14px}
      .card img{height:150px}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div>support@glacierbiolabs.com</div>
      <div class="right">
        <a href="#/shop">Shop</a>
        <a href="#/account">My Account</a>
      </div>
    </div>
  </div>

  <header>
    <div class="wrap header">
      <button type="button" class="hamburger" id="open-drawer" aria-label="Open menu" aria-expanded="false">â˜°</button>

      <a class="brand" href="#/">
        <img id="site-logo" class="logo" src="" alt="Glacier BioLabs" onerror="this.style.display='none'">
        <div class="brand-text">
          <strong>Glacier BioLabs</strong>
          <span>Research Use Only</span>
        </div>
      </a>

      <nav class="desktop-nav" aria-label="Main navigation" id="desktop-nav">
        <a href="#/shop" data-nav="shop">BUY PEPTIDES</a>
        <a href="#/learn" data-nav="learn">ABOUT</a>
        <a href="#/knowledge" data-nav="knowledge">KNOWLEDGE</a>
        <a href="#/faq" data-nav="contact">CONTACT</a>
      </nav>

      <form class="search" id="search-form">
        <label class="sr-only" for="q">Search</label>
        <input id="q" type="search" placeholder="Search products..." autocomplete="off">
        <button type="submit" aria-label="Search">ðŸ”Ž</button>
      </form>

      <div class="header-actions">
        <a class="pill" href="#/shop" title="Browse products">Shop</a>
        <button type="button" id="cart-toggle" class="cart-pill" aria-label="Open cart">
          Cart <span id="cart-count" style="background:var(--accent);color:#fff;padding:4px 8px;border-radius:999px;font-weight:900;margin-left:6px">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile drawer -->
  <div class="drawer-backdrop" id="drawer-backdrop"></div>
  <aside class="drawer" id="drawer" aria-hidden="true">
    <div class="head">
      <strong>Menu</strong>
      <button type="button" class="close" id="close-drawer" aria-label="Close menu">âœ•</button>
    </div>
    <div class="body">
      <a href="#/shop">BUY PEPTIDES</a>
      <a href="#/learn">ABOUT</a>
      <a href="#/knowledge">KNOWLEDGE</a>
      <a href="#/faq">CONTACT</a>
      <a href="#/account">MY ACCOUNT</a>
    </div>
  </aside>

  <!-- Floating offer -->
  <div class="float-offer" id="offer-tab">15% OFF YOUR FIRST ORDER</div>

  <!-- Cart drawer -->
  <div id="cart-drawer" class="cart-drawer" aria-hidden="true">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Your Cart</strong>
      <button type="button" id="close-cart" style="border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px 8px;cursor:pointer">Close</button>
    </div>

    <div id="cart-contents"></div>

    <div id="cart-footer" style="margin-top:8px">
      <div class="cart-total" id="cart-total"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="checkout-from-cart" class="btn primary" style="flex:1" type="button">Checkout</button>
        <button id="clear-cart" class="btn" style="border:1px solid var(--line);background:#fff" type="button">Clear</button>
      </div>
      <div id="paypal-cart-container" style="margin-top:8px"></div>
      <div style="font-size:12px;color:var(--muted);margin-top:8px">Cart checkout uses PayPal (preferred).</div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="gl-toast" aria-live="polite" aria-atomic="true"></div>

  <main id="app"></main>

  <!-- Footer with policy links -->
  <div class="policies">
    <a href="#/terms">Terms & Conditions</a>
    <a href="#/privacy">Privacy Policy</a>
    <a href="#/refunds">Refund & Returns</a>
    <a href="#/shipping">Shipping Policy</a>
    <a href="#/disclaimer">Research Use Disclaimer</a>
    <a href="#/safety">Safety & Compliance</a>
    <a href="#/contact">Contact</a>
    <a href="#/about">About</a>
  </div>

  <footer>
    <div class="wrap">
      Â© <span id="year"></span> Glacier BioLabs â€” Research Use Only â€” Not for human or veterinary use.
    </div>
  </footer>

  <!-- PayPal SDK with hosted-buttons (one script, already includes hosted-buttons) -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAAB9yjG89wJhA520TRN7WjU5k9LHn3BlKfuDruX8-oES9ZMXw1Ac-uT7Y4Ibz7qUJWsqmm7ZEEu1f_G0Y&components=buttons,hosted-buttons&enable-funding=venmo&currency=USD"></script>

  <script>
  /*
    Updates:
    - Inserted hostedButtonId for products (from your PayPal dashboard).
    - Product pages now render PayPal Hosted Buttons (if a hostedButtonId exists) and hide the local "Buy now" button.
    - Global "Buy" handler will use a hosted button (if present) or fallback to client-side PayPal Buttons.
    - Replaced alert() calls with a small toast helper and subtle cart-badge bump animation to look more professional.
    - Cart checkout code left itemized-in-client option available (still client-side; server-side order creation is recommended for production).
  */

  // Minimal PayPal helpers (used by product/cart checkout flows)
  function waitForPayPal(maxTries = 60, interval = 100) {
    return new Promise((resolve, reject) => {
      let tries = 0;
      function step() {
        tries++;
        if (window.paypal && (window.paypal.Buttons || window.paypal.HostedButtons)) return resolve(true);
        if (tries > maxTries) return reject(new Error('PayPal SDK did not load'));
        setTimeout(step, interval);
      }
      step();
    });
  }

  // Render PayPal HostedButtons into a container (no auto click)
  async function renderPayPalHosted(containerId, hostedButtonId) {
    try {
      await waitForPayPal();
    } catch (err) {
      console.warn('PayPal not available for hosted button', err);
      return false;
    }
    const container = document.getElementById(containerId);
    if (!container) return false;
    try {
      window.paypal.HostedButtons({ hostedButtonId }).render('#' + containerId);
      return true;
    } catch (err) {
      console.error('HostedButtons render failed', err);
      return false;
    }
  }

  // Render a hosted button into a temporary hidden container and auto-click it
  // Useful for "Buy" from grid: will open PayPal-hosted flow for the product.
  async function startHostedButtonCheckout(hostedButtonId) {
    try {
      await waitForPayPal();
    } catch (err) {
      showToast('PayPal unavailable', 'error');
      return;
    }

    const tmpId = 'paypal-hosted-tmp-' + Math.random().toString(36).slice(2,10);
    const tmp = document.createElement('div');
    tmp.id = tmpId;
    // keep it visually hidden but attached (some browsers require visible to open popup)
    tmp.style.position = 'absolute';
    tmp.style.left = '-9999px';
    tmp.style.top = '0';
    document.body.appendChild(tmp);

    try {
      await window.paypal.HostedButtons({ hostedButtonId }).render('#' + tmpId);
      // HostedButtons uses a <button> inside; try to auto-click it
      const btn = tmp.querySelector('button');
      if (btn) btn.click();
      // cleanup a bit later
      setTimeout(() => tmp.remove(), 3000);
    } catch (err) {
      console.error('HostedButtons (tmp) render failed', err);
      tmp.remove();
      showToast('Could not initialize PayPal hosted checkout', 'error');
    }
  }

  // Client-side PayPal Buttons for product (fallback when hosted button isn't available)
  async function startPayPalProductCheckout(product, qty = 1) {
    try {
      await waitForPayPal();
    } catch (err) {
      showToast('PayPal not available. Try again later.', 'error');
      return;
    }

    const tmpId = 'paypal-temp-' + Math.random().toString(36).slice(2,9);
    const tmp = document.createElement('div');
    tmp.id = tmpId;
    tmp.style.position = 'absolute';
    tmp.style.left = '-9999px';
    tmp.style.top = '0';
    document.body.appendChild(tmp);

    window.paypal.Buttons({
      createOrder: function(data, actions) {
        const value = ((product.price * qty) / 100).toFixed(2);
        return actions.order.create({
          purchase_units: [{
            amount: { value: value, currency_code: 'USD' },
            description: product.name
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          // recommended: call your server to record the sale
          window.location.href = window.location.origin + '/?checkout=success';
        });
      },
      onError: function(err) {
        console.error('PayPal product checkout error', err);
        showToast('PayPal checkout error', 'error');
      }
    }).render('#' + tmpId).then(() => {
      const btn = tmp.querySelector('button');
      if (btn) btn.click();
      setTimeout(() => tmp.remove(), 3000);
    }).catch(err => {
      console.error('Failed to render PayPal product Buttons', err);
      tmp.remove();
      showToast('Could not initialize PayPal checkout. Please try again.', 'error');
    });
  }

  // Client-side PayPal Buttons for cart (itemized, client-side)
  async function startPayPalCartCheckout() {
    const cart = readCart();
    if (!cart || cart.length === 0) { showToast('Cart is empty', 'info'); return; }

    try {
      await waitForPayPal();
    } catch (err) {
      showToast('PayPal not available. Try again later.', 'error');
      return;
    }

    // build items array from PRODUCTS
    const items = cart.map(item => {
      const p = PRODUCTS.find(x => x.slug === item.slug);
      const name = p ? p.name : item.slug;
      const priceVal = p ? (p.price/100).toFixed(2) : '0.00';
      return {
        name: name,
        unit_amount: { currency_code: 'USD', value: priceVal },
        quantity: String(item.qty || 1)
      };
    });

    const total = items.reduce((s, it) => s + (parseFloat(it.unit_amount.value) * Number(it.quantity)), 0).toFixed(2);

    const containerId = 'paypal-cart-container';
    const container = document.getElementById(containerId);
    if (!container) {
      showToast('Cart container not found', 'error');
      return;
    }
    container.innerHTML = '';

    window.paypal.Buttons({
      createOrder: function(data, actions) {
        return actions.order.create({
          purchase_units: [{
            amount: {
              currency_code: 'USD',
              value: total,
              breakdown: { item_total: { currency_code: 'USD', value: total } }
            },
            items: items
          }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          // best practice: send details to your server for record keeping
          clearCart();
          renderCartDrawer();
          showToast('Payment complete â€” Thank you!', 'success');
          window.location.href = window.location.origin + '/?checkout=success';
        });
      },
      onError: function(err) {
        console.error('PayPal cart error', err);
        showToast('PayPal error. Please try again.', 'error');
      }
    }).render('#' + containerId).then(() => {
      const btn = container.querySelector('button');
      if (btn) btn.click();
    }).catch(err => {
      console.error('Failed to render PayPal cart buttons', err);
      showToast('Unable to initialize PayPal cart checkout.', 'error');
    });
  }

  // ===== Images folder setup =====
  const IMAGE_DIR = 'images/';
  const IMAGE_FILES = {
    logo: 'logo.png',
    retatrutide: 'retatrutide-10mg.png',
    ghk: 'ghk-cu-50mg.png',
    mt2: 'mt2-10mg.png',
    bpc: 'bpc-157-10mg.png',
    water: 'bacteriostatic-water-10ml.png',
    coa: 'coa-sample.png'
  };

  // ===== Products (prices in cents) =====
  // Added hostedButtonId values you provided (so Buy now goes directly to PayPal hosted checkout on product pages).
  const PRODUCTS = [
    {
      slug: 'retatrutide',
      name: 'Retatrutide (10 mg)',
      price: 8500,
      category: 'Peptides',
      inStock: true,
      image: IMAGE_FILES.retatrutide,
      short: 'High-purity compound supplied for controlled laboratory research.',
      long: `Retatrutide is supplied as a lyophilized research compound intended exclusively for laboratory, analytical, and scientific investigation. In published literature it has been examined in controlled models related to metabolic signaling pathways. This listing is for research use only (RUO).`,
      sale: true,
      hostedButtonId: 'L2GZSFWKHT7ZE' // provided
    },
    {
      slug: 'ghk-cu',
      name: 'GHK-Cu (Copper Peptide) â€“ 50 mg',
      price: 4500,
      category: 'Peptides',
      inStock: true,
      image: IMAGE_FILES.ghk,
      short: 'Copper-binding peptide used in research models of skin and tissue biology.',
      long: `GHK-Cu is supplied as a research compound intended for laboratory use only. It is frequently referenced in studies investigating cellular signaling in skin and connective tissue models under controlled experimental conditions.`,
      sale: true,
      hostedButtonId: 'LGKJ7RFBT96BS' // provided
    },
    {
      slug: 'melanotan-ii',
      name: 'Melanotan II (10 mg)',
      price: 4000,
      category: 'Peptides',
      inStock: true,
      image: IMAGE_FILES.mt2,
      short: 'Research analog used to study melanocortin receptor pathways.',
      long: `Melanotan II is supplied as a lyophilized research compound. It is commonly referenced in literature exploring melanocortin receptor signaling pathways in controlled study environments. Research use only.`,
      sale: true,
      hostedButtonId: '4UKSV96CMCZG6' // provided
    },
    {
      slug: 'bpc-157',
      name: 'BPC-157 (10 mg)',
      price: 5500,
      category: 'Peptides',
      inStock: true,
      image: IMAGE_FILES.bpc,
      short: 'Peptide fragment used in controlled research models.',
      long: `BPC-157 is provided strictly as a research compound. It appears in literature related to cellular response and signaling in controlled experimental models. Not for human or veterinary use.`,
      sale: false,
      hostedButtonId: '699XYHCQE3ZV2' // provided
    },
    {
      slug: 'water',
      name: 'Bacteriostatic Water (10 mL)',
      price: 1000,
      category: 'Supplies',
      inStock: true,
      image: IMAGE_FILES.water,
      short: 'Sterile diluent typically used for laboratory reconstitution workflows.',
      long: `Bacteriostatic water is a sterile solution supplied for laboratory handling and reconstitution workflows. This product is intended strictly for non-clinical laboratory use.`,
      sale: false
      // no hosted button provided for water
    }
  ];

  // ===== Helpers =====
  const PLACEHOLDER = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="650"><rect width="100%" height="100%" fill="#ffffff"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#94a3b8" font-family="Arial" font-size="18">Image not available</text></svg>'
  );
  const imgPath = (f) => IMAGE_DIR + f;
  const money = (cents) => '$' + (cents/100).toFixed(2);
  const escapeHtml = (str) => String(str ?? '')
    .replace(/&/g,'&amp;').replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');

  // ===== State for catalog filters/search =====
  const state = {
    q: '',
    inStockOnly: false,
    categories: new Set(),
    minPrice: '',
    maxPrice: '',
    sort: 'default'
  };

  function setActiveNav() {
    const hash = location.hash || '#/';
    document.querySelectorAll('[data-nav]').forEach(a => a.classList.remove('active'));

    if (hash.startsWith('#/shop') || hash === '#/' || hash === '#') {
      const shop = document.querySelector('[data-nav="shop"]');
      if (shop) shop.classList.add('active');
    }
    if (hash.startsWith('#/learn')) {
      const learn = document.querySelector('[data-nav="learn"]');
      if (learn) learn.classList.add('active');
    }
    if (hash.startsWith('#/knowledge')) {
      const k = document.querySelector('[data-nav="knowledge"]');
      if (k) k.classList.add('active');
    }
    if (hash.startsWith('#/faq')) {
      const contact = document.querySelector('[data-nav="contact"]');
      if (contact) contact.classList.add('active');
    }
    // highlight shop when viewing product
    if (hash.startsWith('#/product/')) {
      const shop = document.querySelector('[data-nav="shop"]');
      if (shop) shop.classList.add('active');
    }
  }

  function filterAndSortProducts() {
    let list = PRODUCTS.slice();

    // search
    const q = (state.q || '').trim().toLowerCase();
    if (q) {
      list = list.filter(p => (p.name + ' ' + (p.short||'') + ' ' + (p.category||'')).toLowerCase().includes(q));
    }

    // in stock
    if (state.inStockOnly) list = list.filter(p => p.inStock);

    // categories
    if (state.categories.size > 0) {
      list = list.filter(p => state.categories.has(p.category));
    }

    // price range
    const min = state.minPrice !== '' ? Number(state.minPrice) : null;
    const max = state.maxPrice !== '' ? Number(state.maxPrice) : null;
    if (min != null && !Number.isNaN(min)) list = list.filter(p => p.price >= min*100);
    if (max != null && !Number.isNaN(max)) list = list.filter(p => p.price <= max*100);

    // sort
    if (state.sort === 'price-asc') list.sort((a,b)=>a.price-b.price);
    if (state.sort === 'price-desc') list.sort((a,b)=>b.price-a.price);
    if (state.sort === 'name-asc') list.sort((a,b)=>a.name.localeCompare(b.name));

    return list;
  }

  // ===== Reusable HTML blocks =====
  function productCardHTML(p){
    const img = imgPath(p.image);
    const stockText = p.inStock ? 'In Stock' : 'Out of Stock';
    // Keep Buy button on card as a quick path to PayPal for items without hosted buttons,
    // and for items with hosted buttons the global handler will open the hosted checkout.
    return `
      <article class="card" data-slug="${escapeHtml(p.slug)}">
        <a href="#/product/${encodeURIComponent(p.slug)}" aria-label="${escapeHtml(p.name)}">
          <div class="img-wrap">
            <div class="img-topbar"></div>
            ${p.sale ? `<div class="tag-sale">SALE</div>` : ``}
            <img src="${escapeHtml(img)}" alt="${escapeHtml(p.name)}" onerror="this.onerror=null;this.src='${PLACEHOLDER}'">
          </div>
        </a>
        <div class="body">
          <h3>${escapeHtml(p.name)}</h3>
          <div class="price">${money(p.price)}</div>
          <div class="small">${escapeHtml(p.short || '')}</div>
          <div class="small" style="text-align:center;margin-top:10px;font-weight:900;color:${p.inStock ? 'var(--accent-2)' : 'var(--muted)'}">${escapeHtml(stockText)}</div>
          <div class="actions">
            <button class="btn small" data-add="${escapeHtml(p.slug)}">Add</button>
            <button class="btn small primary" data-buy="${escapeHtml(p.slug)}">Buy</button>
          </div>
        </div>
      </article>
    `;
  }

  // ===== Cart (localStorage) =====
  const CART_KEY = 'glacier_cart_v1';
  function readCart(){
    try {
      const raw = localStorage.getItem(CART_KEY);
      if (!raw) return [];
      return JSON.parse(raw);
    } catch (err) {
      console.warn('Failed to read cart', err);
      return [];
    }
  }
  function saveCart(cart){
    try {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    } catch (err) {
      console.warn('Failed to save cart', err);
    }
    renderCartBadge();
  }
  function animateCartBadge() {
    const el = document.getElementById('cart-count');
    if (!el) return;
    el.classList.add('bump');
    setTimeout(() => el.classList.remove('bump'), 180);
  }
  function addToCart(slug, qty = 1){
    const cart = readCart();
    const idx = cart.findIndex(i => i.slug === slug);
    if (idx >= 0) {
      cart[idx].qty = (cart[idx].qty || 0) + qty;
    } else {
      cart.push({ slug, qty });
    }
    saveCart(cart);
    animateCartBadge();
    showToast('Added to cart');
  }
  function updateCartItem(slug, qty){
    const cart = readCart();
    const idx = cart.findIndex(i => i.slug === slug);
    if (idx >= 0) {
      if (qty <= 0) cart.splice(idx,1);
      else cart[idx].qty = qty;
      saveCart(cart);
    }
  }
  function clearCart(){
    saveCart([]);
    showToast('Cart cleared', 'info');
  }
  function removeFromCart(slug){
    const cart = readCart().filter(i => i.slug !== slug);
    saveCart(cart);
    showToast('Removed from cart', 'info');
  }

  function renderCartBadge(){
    const cart = readCart();
    const totalItems = cart.reduce((s, i) => s + (i.qty || 0), 0);
    const el = document.getElementById('cart-count');
    if (el) el.textContent = totalItems;
  }

  function renderCartDrawer(){
    const el = document.getElementById('cart-contents');
    const totalEl = document.getElementById('cart-total');
    if (!el || !totalEl) return;
    const cart = readCart();
    if (!cart || cart.length === 0) {
      el.innerHTML = `<div class="cart-empty">Your cart is empty</div>`;
      totalEl.textContent = '';
      return;
    }
    const parts = cart.map(item => {
      const p = PRODUCTS.find(x => x.slug === item.slug);
      if (!p) return '';
      const lineTotal = money(p.price * (item.qty || 0));
      return `
        <div class="cart-item" data-slug="${escapeHtml(item.slug)}">
          <div style="display:flex;gap:10px;align-items:center">
            <img src="${escapeHtml(imgPath(p.image))}" alt="${escapeHtml(p.name)}" style="width:56px;height:56px;object-fit:contain;border:1px solid var(--line);border-radius:8px" onerror="this.onerror=null;this.src='${PLACEHOLDER}'">
            <div class="meta">
              <h4>${escapeHtml(p.name)}</h4>
              <p style="font-weight:800">${lineTotal} &nbsp; <span style="font-weight:600;color:var(--muted)">(${item.qty}x)</span></p>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
            <button data-remove="${escapeHtml(item.slug)}" style="border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px;cursor:pointer">Remove</button>
            <div style="display:flex;gap:6px;align-items:center">
              <button data-decr="${escapeHtml(item.slug)}" style="border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px;cursor:pointer">âˆ’</button>
              <span style="min-width:24px;text-align:center">${item.qty}</span>
              <button data-incr="${escapeHtml(item.slug)}" style="border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px;cursor:pointer">ï¼‹</button>
            </div>
          </div>
        </div>
      `;
    }).join('');
    el.innerHTML = parts;
    const totalCents = cart.reduce((sum, item) => {
      const p = PRODUCTS.find(x => x.slug === item.slug);
      return sum + (p ? p.price * (item.qty || 0) : 0);
    }, 0);
    totalEl.textContent = `Total: ${money(totalCents)}`;

    // wire up buttons inside cart
    el.querySelectorAll('[data-remove]').forEach(btn => {
      btn.addEventListener('click', (ev) => {
        const slug = btn.getAttribute('data-remove');
        removeFromCart(slug);
        renderCartDrawer();
      });
    });
    el.querySelectorAll('[data-incr]').forEach(btn => {
      btn.addEventListener('click', () => {
        const slug = btn.getAttribute('data-incr');
        const cart = readCart();
        const item = cart.find(i => i.slug === slug);
        if (item) { item.qty = (item.qty || 0) + 1; saveCart(cart); renderCartDrawer(); }
      });
    });
    el.querySelectorAll('[data-decr]').forEach(btn => {
      btn.addEventListener('click', () => {
        const slug = btn.getAttribute('data-decr');
        const cart = readCart();
        const item = cart.find(i => i.slug === slug);
        if (item) {
          item.qty = (item.qty || 1) - 1;
          if (item.qty <= 0) removeFromCart(slug);
          else saveCart(cart);
          renderCartDrawer();
        }
      });
    });
  }

  // ===== Toast helper (professional UX instead of alert()) =====
  function showToast(text, type = 'info', timeout = 2600) {
    const container = document.getElementById('gl-toast');
    if (!container) return;
    const item = document.createElement('div');
    item.className = 'gl-toast-item';
    item.textContent = text;
    container.appendChild(item);
    setTimeout(() => {
      item.style.transition = 'opacity .28s ease, transform .28s ease';
      item.style.opacity = 0;
      item.style.transform = 'translateY(6px)';
      setTimeout(() => item.remove(), 320);
    }, timeout);
  }

  // ===== Routing / Pages =====
  const app = document.getElementById('app');

  function renderHome(){
    app.innerHTML = `
      <section class="hero">
        <div class="wrap">
          <div>
            <div class="kicker">RESEARCH USE ONLY</div>
            <h1>High-purity compounds for laboratory research</h1>
            <p>Glacier BioLabs supplies analytical-grade peptides and laboratory supplies for controlled, non-clinical research. All products are intended for research purposes only â€” not for human or veterinary use.</p>
            <div class="cta-row">
              <a class="btn primary" href="#/shop">Browse Peptides</a>
              <a class="btn ghost" href="#/learn">Learn More</a>
            </div>
            <div class="badge" style="margin-top:18px">Free standard shipping over $150</div>
          </div>
          <div>
            <div class="panel">
              <strong>Fast, discreet shipping</strong>
              <small>Orders are packaged for laboratory shipments and include required documentation where applicable.</small>
            </div>
            <div style="height:14px"></div>
            <div class="panel">
              <strong>Verified quality</strong>
              <small>Analytical certificates and lot information available on request for research use.</small>
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="wrap">
          <h2>Featured products</h2>
          <div class="subhead">Top picks for lab workflows and analytical studies.</div>

          <div class="grid" id="featured-grid" style="margin-top:18px">
            ${PRODUCTS.slice(0,4).map(p => productCardHTML(p)).join('')}
          </div>
        </div>
      </section>

      <section class="trust">
        <div class="wrap">
          <h2>What researchers appreciate</h2>
          <div class="trust-grid" style="margin-top:18px">
            <div class="trust-card">
              <div class="icon">QC</div>
              <h3>Certificate-ready</h3>
              <p>Lot and QC documentation available to support reproducible research.</p>
            </div>
            <div class="trust-card">
              <div class="icon">SHIP</div>
              <h3>Discreet shipping</h3>
              <p>Packaging designed for laboratory logistics and regulatory compliance.</p>
            </div>
            <div class="trust-card">
              <div class="icon">SUP</div>
              <h3>Research support</h3>
              <p>We provide product data and handling guidance for non-clinical studies.</p>
            </div>
          </div>
        </div>
      </section>
    `;
  }

  function renderShop(){
    const categories = Array.from(new Set(PRODUCTS.map(p => p.category))).sort();
    const list = filterAndSortProducts();

    app.innerHTML = `
      <section class="section">
        <div class="wrap catalog">
          <aside class="filters" id="filters">
            <div class="filter-block">
              <h3>Search</h3>
              <div style="display:flex;gap:8px">
                <input id="filter-q" type="search" placeholder="Search products..." value="${escapeHtml(state.q || '')}" style="width:100%;padding:10px;border:1px solid var(--line);border-radius:10px">
              </div>
            </div>

            <div class="filter-block">
              <h3>Availability</h3>
              <label class="check"><input id="filter-instock" type="checkbox" ${state.inStockOnly ? 'checked' : ''}> In stock only</label>
            </div>

            <div class="filter-block">
              <h3>Category</h3>
              ${categories.map(cat => `
                <label class="check"><input type="checkbox" data-cat="${escapeHtml(cat)}" ${state.categories.has(cat) ? 'checked' : ''}> ${escapeHtml(cat)}</label>
              `).join('')}
            </div>

            <div class="filter-block">
              <h3>Price</h3>
              <div class="price-range">
                <input id="filter-min" type="number" min="0" placeholder="Min $" value="${escapeHtml(state.minPrice || '')}">
                <input id="filter-max" type="number" min="0" placeholder="Max $" value="${escapeHtml(state.maxPrice || '')}">
                <button id="filter-apply" class="btn small">Apply</button>
                <button id="filter-clear" class="btn small">Clear</button>
              </div>
            </div>

          </aside>

          <div>
            <div class="catalog-head">
              <div>
                <div style="font-weight:900;font-size:22px">Catalog</div>
                <div class="count">${list.length} products</div>
              </div>
              <div class="sort">
                <label style="font-weight:800;color:var(--muted);margin-right:6px">Sort</label>
                <select id="sort-select">
                  <option value="default" ${state.sort === 'default' ? 'selected' : ''}>Featured</option>
                  <option value="price-asc" ${state.sort === 'price-asc' ? 'selected' : ''}>Price: Low to High</option>
                  <option value="price-desc" ${state.sort === 'price-desc' ? 'selected' : ''}>Price: High to Low</option>
                  <option value="name-asc" ${state.sort === 'name-asc' ? 'selected' : ''}>Name</option>
                </select>
              </div>
            </div>

            <div class="grid" id="catalog-grid">
              ${list.map(p => productCardHTML(p)).join('')}
            </div>
          </div>
        </div>
      </section>
    `;

    // wire up filter controls
    document.getElementById('filter-q').addEventListener('input', (e) => {
      state.q = e.target.value;
    });
    document.getElementById('filter-instock').addEventListener('change', (e) => {
      state.inStockOnly = e.target.checked;
      rerenderShopGrid();
    });
    document.querySelectorAll('[data-cat]').forEach(ch => {
      ch.addEventListener('change', (e) => {
        const cat = ch.getAttribute('data-cat');
        if (ch.checked) state.categories.add(cat);
        else state.categories.delete(cat);
        rerenderShopGrid();
      });
    });
    document.getElementById('filter-apply').addEventListener('click', () => {
      state.minPrice = document.getElementById('filter-min').value;
      state.maxPrice = document.getElementById('filter-max').value;
      rerenderShopGrid();
    });
    document.getElementById('filter-clear').addEventListener('click', () => {
      state.minPrice = '';
      state.maxPrice = '';
      state.q = '';
      state.inStockOnly = false;
      state.categories = new Set();
      document.getElementById('filter-min').value = '';
      document.getElementById('filter-max').value = '';
      document.getElementById('filter-q').value = '';
      document.querySelectorAll('[data-cat]').forEach(ch => ch.checked = false);
      document.getElementById('filter-instock').checked = false;
      rerenderShopGrid();
    });
    document.getElementById('sort-select').addEventListener('change', (e) => {
      state.sort = e.target.value;
      rerenderShopGrid();
    });

    // delegate buttons (Add / Buy) in grid
    document.getElementById('catalog-grid').addEventListener('click', (ev) => {
      const add = ev.target.closest('[data-add]');
      const buy = ev.target.closest('[data-buy]');
      if (add) {
        const slug = add.getAttribute('data-add');
        addToCart(slug, 1);
        renderCartDrawer();
      } else if (buy) {
        const slug = buy.getAttribute('data-buy');
        const prod = PRODUCTS.find(p => p.slug === slug);
        if (!prod) return;
        // If hosted button exists, use it (hosted flow). Otherwise use client-side Buttons
        if (prod.hostedButtonId) startHostedButtonCheckout(prod.hostedButtonId);
        else startPayPalProductCheckout(prod, 1);
      }
    });
  }

  function rerenderShopGrid(){
    const grid = document.getElementById('catalog-grid');
    if (!grid) return;
    const list = filterAndSortProducts();
    grid.innerHTML = list.map(p => productCardHTML(p)).join('');
  }

  function renderProduct(slug){
    const p = PRODUCTS.find(x => x.slug === slug);
    if (!p) {
      app.innerHTML = `<div class="wrap"><h2>Product not found</h2><p class="muted">We could not find the requested product.</p></div>`;
      return;
    }

    // determine hosted container id
    const hostedContainerId = p.hostedButtonId ? ('product-paypal-hosted-' + encodeURIComponent(p.slug)) : '';

    app.innerHTML = `
      <section class="section">
        <div class="wrap">
          <div class="crumbs"><a class="backlink" href="#/shop">Catalog</a> â€º <span style="font-weight:900">${escapeHtml(p.name)}</span></div>

          <div class="product-page">
            <div class="media">
              <div class="img-topbar"></div>
              <img src="${escapeHtml(imgPath(p.image))}" alt="${escapeHtml(p.name)}" onerror="this.onerror=null;this.src='${PLACEHOLDER}'">
            </div>
            <div class="pinfo">
              <h1>${escapeHtml(p.name)}</h1>
              <div class="rating-row">
                <div style="font-weight:900;color:var(--accent-2)">${money(p.price)}</div>
                <div class="muted" style="font-weight:700">${p.category}</div>
                <div class="muted" style="font-weight:700">${p.inStock ? 'In stock' : 'Out of stock'}</div>
              </div>
              <div class="desc">${escapeHtml(p.long)}</div>

              <div class="ruo">Research Use Only â€” Not for human or veterinary use.</div>

              <div class="form">
                <div class="order-row">
                  <div class="field" style="max-width:120px">
                    <label for="qty">Qty</label>
                    <select id="qty">
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="5">5</option>
                    </select>
                  </div>
                  <div style="flex:1">
                    <label class="sr-only">Add to cart</label>
                    <div class="order-cta" style="display:flex;gap:8px;align-items:center">
                      <button id="add-to-cart" class="btn" type="button">Add to cart</button>
                      <!-- If hostedButtonId exists we'll render hosted PayPal here and hide the local button -->
                      <button id="buy-now" class="btn primary full" type="button" ${p.hostedButtonId ? 'style="display:none"' : ''}>Buy now</button>
                    </div>
                  </div>
                </div>
                <div class="order-help">Orders are processed via PayPal. Documentation available for research orders.</div>
                <div id="${hostedContainerId}" style="margin-top:8px"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    `;

    // add handlers
    document.getElementById('add-to-cart').addEventListener('click', () => {
      const qty = Number(document.getElementById('qty').value) || 1;
      addToCart(p.slug, qty);
      renderCartDrawer();
    });

    if (!p.hostedButtonId) {
      // fallback: local createOrder PayPal flow
      document.getElementById('buy-now').addEventListener('click', () => {
        const qty = Number(document.getElementById('qty').value) || 1;
        startPayPalProductCheckout(p, qty);
      });
    } else {
      // render the hosted button in-place and keep Buy now hidden
      renderPayPalHosted(hostedContainerId, p.hostedButtonId).then(ok => {
        if (!ok) {
          // if hosted button couldn't render, fallback to enabling the Buy button to use client-side checkout
          const bn = document.getElementById('buy-now');
          if (bn) {
            bn.style.display = '';
            bn.addEventListener('click', () => {
              const qty = Number(document.getElementById('qty').value) || 1;
              startPayPalProductCheckout(p, qty);
            });
          }
        }
      });
    }
  }

  // Policy pages (detailed content supplied by owner)
  const POLICY_PAGES = {
    terms: {
      title: 'Terms & Conditions',
      body: `
        <p>By accessing or purchasing from Glacier BioLabs, you agree to the following terms and conditions.</p>
        <p>All products sold by Glacier BioLabs are intended strictly for laboratory research and analytical purposes only. Products are not intended for human or veterinary use, consumption, injection, diagnosis, treatment, or prevention of any disease.</p>
        <p>Glacier BioLabs does not provide medical advice, dosing instructions, or usage guidance of any kind. No medical or health claims are made regarding any product sold.</p>
        <p>Buyers are solely responsible for ensuring compliance with all applicable local, state, federal, and international laws and regulations related to the purchase, possession, and use of research materials.</p>
        <p>Glacier BioLabs reserves the right to refuse service, cancel orders, or limit quantities at our discretion.</p>
        <p>All content on this website is provided for informational purposes only and does not constitute professional, medical, or legal advice.</p>
      `
    },
    privacy: {
      title: 'Privacy Policy',
      body: `
        <p>Glacier BioLabs respects your privacy.</p>
        <p>We collect limited personal information necessary to process orders and provide customer support, including name, email address, shipping address, and order details.</p>
        <p>Payments are securely processed by third-party payment providers such as PayPal. Glacier BioLabs does not store or have access to your full payment information.</p>
        <p>We do not sell, rent, or share personal data with third parties except as required to complete transactions, comply with legal obligations, or operate our services.</p>
        <p>We may use cookies or basic analytics to improve website performance and user experience.</p>
        <p>By using this website, you consent to this Privacy Policy.</p>
      `
    },
    refunds: {
      title: 'Refund & Returns',
      body: `
        <p>Due to the nature of laboratory research materials, all sales are final.</p>
        <p>We do not accept returns or offer refunds once an order has been processed or shipped.</p>
        <p>Refunds or replacements may be considered only in cases where an item arrives damaged or incorrect. Any issues must be reported within 48 hours of delivery by contacting <a href="mailto:support@glacierbiolabs.com">support@glacierbiolabs.com</a>.</p>
        <p>Approved refunds or replacements are issued at the sole discretion of Glacier BioLabs.</p>
      `
    },
    shipping: {
      title: 'Shipping Policy',
      body: `
        <p>Orders are typically processed within 1â€“2 business days.</p>
        <p>All shipments include tracking information once dispatched.</p>
        <p>Shipping times vary depending on destination and carrier. Glacier BioLabs is not responsible for delays caused by carriers, weather conditions, or incorrect address information provided by the customer.</p>
        <p>Shipping is currently available within the United States unless otherwise stated.</p>
      `
    },
    disclaimer: {
      title: 'Research Use Only Disclaimer',
      body: `
        <p>All products sold by Glacier BioLabs are intended strictly for laboratory research and analytical purposes.</p>
        <p>Products are not intended for human or veterinary use, consumption, injection, diagnosis, treatment, or prevention of any condition or disease.</p>
        <p>No dosing information, usage instructions, or application guidance is provided or implied.</p>
        <p>By purchasing from Glacier BioLabs, the buyer acknowledges and agrees to these restrictions.</p>
      `
    },
    contact: {
      title: 'Contact',
      body: `
        <p>For customer support or order inquiries, please contact us at:</p>
        <p><a href="mailto:support@glacierbiolabs.com">support@glacierbiolabs.com</a></p>
        <p>We aim to respond to all inquiries within 1â€“2 business days.</p>
      `
    },
    about: {
      title: 'About Glacier BioLabs',
      body: `
        <p>Glacier BioLabs is a research-focused supplier of laboratory materials intended exclusively for scientific and analytical research purposes.</p>
        <p>Our mission is to provide clearly labeled, professionally presented research compounds while maintaining transparency, compliance, and responsible business practices.</p>
        <p>All products are sold strictly for research use only and are not intended for human or veterinary use.</p>
      `
    },
    safety: {
      title: 'Safety & Compliance',
      body: `
        <p>Glacier BioLabs sells products exclusively for laboratory research and analytical use. We take safety and compliance seriously.</p>
        <p>Key safety and compliance points:</p>
        <ul>
          <li>All products are labeled and sold as Research Use Only (RUO). They are not intended for human or veterinary use.</li>
          <li>We do not provide dosing, administration, or medical use instructions.</li>
          <li>Buyers must ensure products are used only in controlled laboratory or institutional settings and in accordance with applicable laws and institutional policies.</li>
          <li>We ship to verified laboratory or institutional addresses and may require additional documentation for certain shipments.</li>
          <li>Payments are processed by third-party providers (e.g., PayPal); Glacier BioLabs is not involved in payment processing beyond order fulfillment.</li>
        </ul>
        <p>If you require certificates, lot documentation, or compliance information for your institutional records, contact <a href="mailto:support@glacierbiolabs.com">support@glacierbiolabs.com</a>.</p>
      `
    }
  };

  function renderPolicy(slug){
    const page = POLICY_PAGES[slug];
    if (!page) {
      app.innerHTML = `<div class="wrap"><h2>Page not found</h2></div>`;
      return;
    }
    app.innerHTML = `
      <section class="section">
        <div class="wrap">
          <h2>${escapeHtml(page.title)}</h2>
          <div class="subhead muted">${escapeHtml(page.title)} for Glacier BioLabs</div>
          <div style="margin-top:12px;color:var(--ink)">${page.body}</div>
        </div>
      </section>
    `;
  }

  // Router
  function router(){
    setActiveNav();
    const hash = location.hash || '#/';
    if (hash === '#' || hash === '#/' || hash === '') {
      renderHome();
      return;
    }
    if (hash.startsWith('#/shop')) {
      renderShop();
      return;
    }
    if (hash.startsWith('#/product/')) {
      const slug = decodeURIComponent(hash.replace('#/product/', '').split('?')[0]);
      renderProduct(slug);
      return;
    }
    // policy pages
    if (hash.startsWith('#/terms')) return renderPolicy('terms');
    if (hash.startsWith('#/privacy')) return renderPolicy('privacy');
    if (hash.startsWith('#/refunds')) return renderPolicy('refunds');
    if (hash.startsWith('#/shipping')) return renderPolicy('shipping');
    if (hash.startsWith('#/disclaimer')) return renderPolicy('disclaimer');
    if (hash.startsWith('#/contact')) return renderPolicy('contact');
    if (hash.startsWith('#/about')) return renderPolicy('about');
    if (hash.startsWith('#/safety')) return renderPolicy('safety');

    // fallback
    app.innerHTML = `<div class="wrap"><h2>Page not found</h2></div>`;
  }

  // ===== UI: drawer, cart toggle, search handling =====
  document.getElementById('open-drawer').addEventListener('click', () => {
    const d = document.getElementById('drawer');
    const b = document.getElementById('drawer-backdrop');
    d.classList.add('open');
    b.style.display = 'block';
    d.setAttribute('aria-hidden', 'false');
    document.getElementById('open-drawer').setAttribute('aria-expanded', 'true');
  });
  document.getElementById('close-drawer').addEventListener('click', closeDrawer);
  document.getElementById('drawer-backdrop').addEventListener('click', closeDrawer);
  function closeDrawer(){
    const d = document.getElementById('drawer');
    const b = document.getElementById('drawer-backdrop');
    d.classList.remove('open');
    b.style.display = 'none';
    d.setAttribute('aria-hidden', 'true');
    document.getElementById('open-drawer').setAttribute('aria-expanded', 'false');
  }

  // Cart toggle
  document.getElementById('cart-toggle').addEventListener('click', () => {
    const cd = document.getElementById('cart-drawer');
    const open = cd.classList.toggle('open');
    cd.setAttribute('aria-hidden', open ? 'false' : 'true');
    if (open) renderCartDrawer();
  });
  document.getElementById('close-cart').addEventListener('click', () => {
    const cd = document.getElementById('cart-drawer');
    cd.classList.remove('open');
    cd.setAttribute('aria-hidden', 'true');
  });

  // checkout from cart
  document.getElementById('checkout-from-cart').addEventListener('click', () => {
    startPayPalCartCheckout();
  });
  document.getElementById('clear-cart').addEventListener('click', () => {
    if (confirm('Clear entire cart?')) {
      clearCart();
      renderCartDrawer();
    }
  });

  // delegate add/buy globally (for featured grid and others)
  document.body.addEventListener('click', (ev) => {
    const add = ev.target.closest('[data-add]');
    const buy = ev.target.closest('[data-buy]');
    if (add) {
      const slug = add.getAttribute('data-add');
      addToCart(slug, 1);
      renderCartDrawer();
    } else if (buy) {
      const slug = buy.getAttribute('data-buy');
      const prod = PRODUCTS.find(p => p.slug === slug);
      if (!prod) return;
      if (prod.hostedButtonId) startHostedButtonCheckout(prod.hostedButtonId);
      else startPayPalProductCheckout(prod, 1);
    }
  });

  // search form behavior
  document.getElementById('search-form').addEventListener('submit', (e) => {
    e.preventDefault();
    const q = document.getElementById('q').value || '';
    state.q = q;
    // navigate to shop and keep filters
    location.hash = '#/shop';
    // small delay to ensure router ran
    setTimeout(() => {
      const qinput = document.getElementById('filter-q');
      if (qinput) qinput.value = q;
      rerenderShopGrid();
    }, 60);
  });

  // initialize site logo and year
  (function initBranding(){
    const logoEl = document.getElementById('site-logo');
    if (logoEl) {
      logoEl.src = imgPath(IMAGE_FILES.logo);
      logoEl.onerror = function(){ this.style.display = 'none'; };
    }
    const y = new Date().getFullYear();
    document.getElementById('year').textContent = y;
  })();

  // initial render
  window.addEventListener('hashchange', router);
  window.addEventListener('load', () => {
    router();
    renderCartBadge();
  });

  // expose some helpers for debugging (optional)
  window.Glacier = {
    PRODUCTS, addToCart, readCart, clearCart, startPayPalProductCheckout, startPayPalCartCheckout, startHostedButtonCheckout
  };
  </script>
</body>
</html>