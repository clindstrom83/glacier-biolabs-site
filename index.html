<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Glacier BioLabs â€” Research Peptides</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Glacier BioLabs â€” Research Use Only compounds." />
  <style>
    :root{
      --accent:#d0352c;
      --accent-2:#b12a24;
      --accent-soft: rgba(208,53,44,.10);
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --bg:#ffffff;
      --card:#ffffff;
      --shadow: 0 10px 25px rgba(2,6,23,.08);
      --radius: 14px;
      --max: 1180px;
      --topbar-h: 36px;
      --header-h: 72px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background:var(--bg);
      color:var(--ink);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:inherit;text-decoration:none}
    button,input,select,textarea{font:inherit}
    img{display:block;max-width:100%}

    .wrap{max-width:var(--max); margin:0 auto; padding:0 16px}
    .muted{color:var(--muted)}
    .sr-only{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}

    /* Topbar + Header */
    .topbar{
      height:var(--topbar-h);
      background:var(--accent-2);
      color:#fff;
      display:flex;
      align-items:center;
      font-size:13px;
    }
    .topbar .wrap{display:flex;align-items:center;justify-content:space-between}
    .topbar a{color:#fff}
    header{
      position:sticky; top:0; z-index:50;
      background:#fff; border-bottom:1px solid var(--line);
    }
    .header{height:var(--header-h);display:flex;align-items:center;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;min-width:220px}
    .logo{height:40px;width:auto}
    .brand-text strong{font-size:15px}
    nav.desktop-nav{flex:1;display:flex;align-items:center;justify-content:center;gap:18px;font-weight:600}
    nav.desktop-nav a{padding:10px 8px;border-radius:10px}
    nav.desktop-nav a.active{color:var(--accent-2);background:var(--accent-soft)}
    .search{display:flex;align-items:center;width:360px;max-width:38vw}
    .search input{width:100%;border:1px solid var(--line);border-right:none;padding:11px 12px;border-radius:999px 0 0 999px}
    .search button{border:1px solid var(--line);background:var(--accent);color:#fff;padding:11px 14px;border-radius:0 999px 999px 0;cursor:pointer}
    .header-actions{display:flex;align-items:center;gap:10px}
    .cart-pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border:1px solid var(--line);border-radius:999px;font-weight:700;cursor:pointer}
    .bump{transform:scale(1.06);transition:transform .12s ease}

    /* Drawer / Modal */
    .hamburger{display:none;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px;cursor:pointer}
    .drawer-backdrop{position:fixed;inset:0;background:rgba(2,6,23,.55);display:none;z-index:60}
    .drawer{position:fixed;top:0;right:0;height:100%;width:min(420px,92vw);background:#fff;z-index:70;transform:translateX(100%);transition:transform .25s ease;display:flex;flex-direction:column}
    .drawer.open{transform:translateX(0)}
    .drawer .head{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between}
    .drawer .body{padding:16px;display:flex;flex-direction:column;gap:8px}
    .drawer .body a{padding:12px;border:1px solid var(--line);border-radius:12px}

    #paypal-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,.5);z-index:220}
    #paypal-modal.open{display:flex}
    #paypal-modal .modal{width:min(520px,94vw);background:#fff;border-radius:12px;padding:14px;box-shadow:0 20px 60px rgba(2,6,23,.45)}
    #paypal-modal .modal .close{background:#fff;border:1px solid var(--line);padding:6px 8px;border-radius:8px;cursor:pointer}

    /* Hero */
    .hero{position:relative;overflow:hidden;border-bottom:1px solid var(--line);background:linear-gradient(135deg, rgba(2,6,23,.75), rgba(2,6,23,.45))}
    .hero::before{content:"";position:absolute;inset:0;background:url("images/hero.jpg") center/cover no-repeat;opacity:.18;filter:saturate(1.05) contrast(1.02)}
    .hero .wrap{position:relative;padding:56px 16px 48px;display:grid;grid-template-columns:1.2fr .8fr;gap:26px;align-items:center}
    .hero h1{margin:0;color:#fff;font-size:42px}
    .hero p{margin:10px 0 0;color:rgba(255,255,255,.88);max-width:56ch}
    .kicker{display:inline-flex;gap:10px;align-items:center;color:rgba(255,255,255,.85);font-weight:800;letter-spacing:.18em;text-transform:uppercase;font-size:12px;margin-bottom:10px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:12px 16px;border-radius:999px;font-weight:800;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,.12);color:#fff}

    /* Sections */
    main{padding:24px 0 0}
    .section{padding:26px 0}
    .section h2{margin:0 0 14px;font-size:26px}
    .subhead{margin:-8px 0 18px;color:var(--muted);line-height:1.45}

    /* Catalog */
    .catalog{display:grid;grid-template-columns:280px 1fr;gap:26px;align-items:start}
    aside.filters{border-right:1px solid var(--line);padding-right:18px}
    .filter-block{padding:6px 0 16px}
    .check{display:flex;align-items:center;gap:10px;padding:10px 0;cursor:pointer;font-weight:600}
    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:18px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);overflow:hidden;transition:transform .14s ease,box-shadow .14s ease}
    .card:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
    .card .img-wrap{position:relative;background:#fff;border-bottom:1px solid var(--line);padding:12px}
    .card img{width:100%;height:170px;object-fit:contain;border-radius:12px}
    .tag-sale{position:absolute;left:12px;top:14px;background:var(--accent);color:#fff;padding:8px 10px;border-radius:12px;font-weight:900}
    .card .body{padding:14px}
    .card h3{margin:0;font-size:15px;min-height:38px}
    .price{text-align:center;font-weight:900;color:var(--accent-2);margin:6px 0 10px}
    .small{color:var(--muted);font-size:13px;line-height:1.35}
    .card .actions{margin-top:12px;display:flex;gap:8px}
    .btn.small{padding:8px 12px;font-size:13px;border-radius:12px;flex:1}

    /* Product page */
    .product-page{display:grid;grid-template-columns:520px 1fr;gap:26px;align-items:start;padding-bottom:12px}
    .media{border:1px solid var(--line);border-radius:var(--radius);padding:14px;background:#fff}
    .media img{width:100%;height:420px;object-fit:contain;border-radius:12px}
    .pinfo h1{margin:0;font-size:34px}
    .rating-row{display:flex;align-items:center;gap:10px;margin:10px 0;color:var(--muted);font-weight:700}
    .big-price{font-size:34px;font-weight:950;color:var(--accent-2)}
    .ruo{margin-top:14px;padding:12px;border-radius:12px;background:var(--accent-soft);border:1px solid rgba(208,53,44,.18);font-weight:900;color:var(--accent-2)}

    /* Cart drawer */
    .cart-drawer{position:fixed;right:18px;top:88px;width:340px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:var(--shadow);z-index:80;padding:12px;display:none;flex-direction:column;gap:8px}
    .cart-drawer.open{display:flex}

    /* Footer */
    .policies{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;padding:14px 0 8px;background:#0b0f19;color:rgba(255,255,255,.8)}
    .policies a{color:rgba(255,255,255,.9);font-weight:700}
    footer .wrap{padding:12px 0;color:var(--muted);font-size:13px}

    /* Responsive */
    @media (max-width:1100px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media (max-width:900px){
      .search{display:none}
      nav.desktop-nav{display:none}
      .hamburger{display:inline-flex}
      .brand{min-width:unset}
      .hero .wrap{grid-template-columns:1fr;padding:42px 16px 36px}
      .catalog{grid-template-columns:1fr}
      aside.filters{display:none}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
      .product-page{grid-template-columns:1fr}
      .media img{height:320px}
      .trust-grid{grid-template-columns:1fr}
      .cart-drawer{right:10px;left:10px;top:auto;bottom:16px;width:auto}
    }
    @media (max-width:430px){.hero h1{font-size:30px}.card img{height:150px}}
  </style>
</head>

<body>
  <div class="topbar" role="banner">
    <div class="wrap">
      <div>glacierbiolabs@outlook.com</div>
      <div>
        <a href="#/shop">Shop</a>
        <a href="#/account" style="margin-left:12px">My Account</a>
      </div>
    </div>
  </div>

  <header>
    <div class="wrap header" role="navigation" aria-label="Top navigation">
      <button id="open-drawer" class="hamburger" aria-label="Open menu" aria-expanded="false">â˜°</button>

      <a class="brand" href="#/" aria-label="Glacier BioLabs homepage">
        <img id="site-logo" class="logo" src="" alt="Glacier BioLabs logo" onerror="this.style.display='none'">
        <div class="brand-text">
          <strong>Glacier BioLabs</strong>
          <span class="muted">Research Use Only</span>
        </div>
      </a>

      <nav class="desktop-nav" aria-label="Main navigation" id="desktop-nav">
        <a href="#/shop" data-nav="shop">BUY PEPTIDES</a>
        <a href="#/learn" data-nav="learn">ABOUT</a>
        <a href="#/knowledge" data-nav="knowledge">KNOWLEDGE</a>
        <a href="#/faq" data-nav="contact">CONTACT</a>
      </nav>

      <form id="search-form" class="search" role="search" aria-label="Product search">
        <label for="q" class="sr-only">Search products</label>
        <input id="q" type="search" placeholder="Search products..." autocomplete="off">
        <button type="submit" aria-label="Search">ðŸ”Ž</button>
      </form>

      <div class="header-actions">
        <a class="pill" href="#/shop" title="Browse products">Shop</a>
        <button id="cart-toggle" class="cart-pill" aria-haspopup="dialog" aria-controls="cart-drawer" aria-expanded="false">
          Cart <span id="cart-count" style="background:var(--accent);color:#fff;padding:4px 8px;border-radius:999px;font-weight:900;margin-left:6px">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile drawer -->
  <div id="drawer-backdrop" class="drawer-backdrop" tabindex="-1" aria-hidden="true"></div>
  <aside id="drawer" class="drawer" aria-hidden="true" aria-label="Mobile menu">
    <div class="head">
      <strong>Menu</strong>
      <button id="close-drawer" class="close" aria-label="Close menu">âœ•</button>
    </div>
    <div class="body">
      <a href="#/shop">BUY PEPTIDES</a>
      <a href="#/learn">ABOUT</a>
      <a href="#/knowledge">KNOWLEDGE</a>
      <a href="#/faq">CONTACT</a>
      <a href="#/account">MY ACCOUNT</a>
    </div>
  </aside>

  <!-- Floating offer -->
  <div class="float-offer" id="offer-tab" style="position:fixed;left:18px;bottom:18px;background:var(--accent);color:#fff;padding:10px 12px;border-radius:12px;box-shadow:var(--shadow)">15% OFF YOUR FIRST ORDER</div>

  <!-- Cart drawer -->
  <div id="cart-drawer" class="cart-drawer" role="dialog" aria-modal="false" aria-hidden="true" aria-labelledby="cart-title">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong id="cart-title">Your Cart</strong>
      <button id="close-cart" class="close" aria-label="Close cart">Close</button>
    </div>

    <div id="cart-contents" aria-live="polite"></div>

    <div id="cart-footer" style="margin-top:8px">
      <div class="cart-total" id="cart-total" aria-atomic="true"></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="checkout-from-cart" class="btn primary" style="flex:1" type="button">Checkout</button>
        <button id="clear-cart" class="btn" style="border:1px solid var(--line);background:#fff" type="button">Clear</button>
      </div>
      <div id="paypal-cart-container" style="margin-top:12px"></div>
      <div style="font-size:12px;color:var(--muted);margin-top:8px">Cart checkout uses PayPal (preferred).</div>
    </div>
  </div>

  <!-- PayPal modal -->
  <div id="paypal-modal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="paypal-modal-title">
      <div class="modal-head" style="display:flex;justify-content:space-between;align-items:center;">
        <div id="paypal-modal-title" style="font-weight:900">Secure PayPal Checkout</div>
        <button id="paypal-modal-close" class="close" aria-label="Close checkout">Close</button>
      </div>
      <div id="paypal-modal-body" style="margin-top:12px">
        <div id="paypal-modal-info" class="muted"></div>
        <div id="paypal-modal-buttons" style="margin-top:12px"></div>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="gl-toast" aria-live="polite" aria-atomic="true"></div>

  <main id="app" role="main" class="wrap"></main>

  <!-- Footer -->
  <div class="policies">
    <a href="#/terms">Terms & Conditions</a>
    <a href="#/privacy">Privacy Policy</a>
    <a href="#/refunds">Refund & Returns</a>
    <a href="#/shipping">Shipping Policy</a>
    <a href="#/disclaimer">Research Use Disclaimer</a>
    <a href="#/safety">Safety & Compliance</a>
    <a href="#/contact">Contact</a>
    <a href="#/about">About</a>
  </div>

  <footer>
    <div class="wrap">
      Â© <span id="year"></span> Glacier BioLabs â€” Research Use Only â€” Not for human or veterinary use.
    </div>
  </footer>

  <!-- Application script -->
  <script>
  /**
   * Rewritten application script â€” improved structure, accessibility, and maintainability.
   *
   * PayPal SDK:
   * - This build will not include a hard-coded client-id.
   * - Set PAYPAL_CLIENT_ID to a string to load the SDK at runtime, or leave empty to disable PayPal features.
   * - Example: const PAYPAL_CLIENT_ID = 'YOUR_CLIENT_ID_HERE';
   *
   * NOTE: replace the placeholder with your client id for production/testing. If you prefer the
   * original static <script src="https://www.paypal.com/sdk/js?..."> approach, you can add it back,
   * but be aware of exposing live credentials in public repositories.
   */

  const PAYPAL_CLIENT_ID = ''; // <-- REPLACE WITH_YOUR_CLIENT_ID or set programmatically

  // Utility: dynamic load of PayPal SDK if client id present
  function loadPayPalSdk(clientId) {
    return new Promise((resolve, reject) => {
      if (!clientId) return resolve(false);
      if (window.paypal && (window.paypal.Buttons || window.paypal.HostedButtons)) return resolve(true);
      const existing = Array.from(document.getElementsByTagName('script'))
        .find(s => s.src && s.src.includes('paypal.com/sdk/js'));
      if (existing) {
        // script present but SDK not ready yet
        const check = () => {
          if (window.paypal && (window.paypal.Buttons || window.paypal.HostedButtons)) return resolve(true);
          setTimeout(check, 100);
        };
        return check();
      }
      const s = document.createElement('script');
      s.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(clientId)}&components=buttons,hosted-buttons&enable-funding=venmo&currency=USD`;
      s.async = true;
      s.onload = () => {
        // small delay while SDK initializes
        setTimeout(() => resolve(!!window.paypal), 60);
      };
      s.onerror = (e) => reject(new Error('Failed to load PayPal SDK'));
      document.head.appendChild(s);
    });
  }

  // Small helpers
  const IMAGE_DIR = 'images/';
  const IMAGES = {
    logo: 'logo.png',
    retatrutide: 'retatrutide-10mg.png',
    ghk: 'ghk-cu-50mg.png',
    mt2: 'mt2-10mg.png',
    bpc: 'bpc-157-10mg.png',
    water: 'bacteriostatic-water-10ml.png',
    coa: 'coa-sample.png'
  };

  const DEFAULT_PLACEHOLDER = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="900" height="650"><rect width="100%" height="100%" fill="#ffffff"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#94a3b8" font-family="Arial" font-size="18">Image not available</text></svg>'
  );

  const money = cents => '$' + (Number(cents)/100).toFixed(2);
  const imgPath = (name) => IMAGE_DIR + name;
  const esc = (s) => String(s ?? '');

  // Product catalog (prices in cents)
  const PRODUCTS = [
    {
      slug: 'retatrutide',
      name: 'Retatrutide (10 mg)',
      price: 6500, // $65.00 (updated per request)
      category: 'Peptides',
      inStock: true,
      image: IMAGES.retatrutide,
      short: 'High-purity compound supplied for controlled laboratory research.',
      long: 'Retatrutide is supplied as a lyophilized research compound intended exclusively for laboratory, analytical, and scientific investigation. This listing is for research use only (RUO).',
      sale: true,
      hostedButtonId: 'L2GZSFWKHT7ZE'
    },
    {
      slug: 'ghk-cu',
      name: 'GHK-Cu (Copper Peptide) â€“ 50 mg',
      price: 4500,
      category: 'Peptides',
      inStock: true,
      image: IMAGES.ghk,
      short: 'Copper-binding peptide used in research models of skin and tissue biology.',
      long: 'GHK-Cu is supplied as a research compound intended for laboratory use only. It is frequently referenced in studies investigating cellular signaling in skin and connective tissue models under controlled experimental conditions.',
      sale: true,
      hostedButtonId: 'LGKJ7RFBT96BS'
    },
    {
      slug: 'melanotan-ii',
      name: 'Melanotan II (10 mg)',
      price: 4000,
      category: 'Peptides',
      inStock: true,
      image: IMAGES.mt2,
      short: 'Research analog used to study melanocortin receptor pathways.',
      long: 'Melanotan II is supplied as a lyophilized research compound. It is commonly referenced in literature exploring melanocortin receptor signaling pathways in controlled study environments. Research use only.',
      sale: true,
      hostedButtonId: '4UKSV96CMCZG6'
    },
    {
      slug: 'bpc-157',
      name: 'BPC-157 (10 mg)',
      price: 5500,
      category: 'Peptides',
      inStock: true,
      image: IMAGES.bpc,
      short: 'Peptide fragment used in controlled research models.',
      long: 'BPC-157 is provided strictly as a research compound. It appears in literature related to cellular response and signaling in controlled experimental models. Not for human or veterinary use.',
      sale: false,
      hostedButtonId: '699XYHCQE3ZV2'
    },
    {
      slug: 'water',
      name: 'Bacteriostatic Water (10 mL)',
      price: 1000,
      category: 'Supplies',
      inStock: true,
      image: IMAGES.water,
      short: 'Sterile diluent typically used for laboratory reconstitution workflows.',
      long: 'Bacteriostatic water is a sterile solution supplied for laboratory handling and reconstitution workflows. This product is intended strictly for non-clinical laboratory use.',
      sale: false,
      hostedButtonId: '7URDJP2ZKGVQN'
    }
  ];

  // App state & filters
  const state = {
    q: '',
    inStockOnly: false,
    categories: new Set(),
    minPrice: '',
    maxPrice: '',
    sort: 'default'
  };

  // LocalStorage cart key
  const CART_KEY = 'glacier_cart_v1';

  function readCart() {
    try {
      const raw = localStorage.getItem(CART_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch (e) {
      console.warn('cart read failed', e);
      return [];
    }
  }
  function saveCart(cart) {
    try { localStorage.setItem(CART_KEY, JSON.stringify(cart)); }
    catch (e) { console.warn('cart save failed', e); }
    renderCartBadge();
  }

  function addToCart(slug, qty = 1) {
    const cart = readCart();
    const idx = cart.findIndex(i => i.slug === slug);
    if (idx >= 0) cart[idx].qty = (cart[idx].qty || 0) + qty;
    else cart.push({ slug, qty });
    saveCart(cart);
    animateCartBadge();
    showToast('Added to cart', 'success');
  }
  function updateCartItem(slug, qty) {
    const cart = readCart();
    const idx = cart.findIndex(i => i.slug === slug);
    if (idx >= 0) {
      if (qty <= 0) cart.splice(idx, 1);
      else cart[idx].qty = qty;
      saveCart(cart);
    }
  }
  function removeFromCart(slug) {
    const next = readCart().filter(i => i.slug !== slug);
    saveCart(next);
    showToast('Removed from cart', 'info');
  }
  function clearCart() {
    saveCart([]);
    showToast('Cart cleared', 'info');
  }

  function animateCartBadge() {
    const el = document.getElementById('cart-count');
    if (!el) return;
    el.classList.add('bump');
    setTimeout(() => el.classList.remove('bump'), 180);
  }

  function renderCartBadge() {
    const el = document.getElementById('cart-count');
    if (!el) return;
    const total = readCart().reduce((s, i) => s + (i.qty || 0), 0);
    el.textContent = total;
  }

  function showToast(text, type = 'info', timeout = 2600) {
    const container = document.getElementById('gl-toast');
    if (!container) return;
    const item = document.createElement('div');
    item.className = 'gl-toast-item';
    item.textContent = text;
    container.appendChild(item);
    setTimeout(() => {
      item.style.transition = 'opacity .28s ease, transform .28s ease';
      item.style.opacity = 0;
      item.style.transform = 'translateY(6px)';
      setTimeout(() => item.remove(), 320);
    }, timeout);
  }

  // Filtering and sorting
  function filterAndSortProducts() {
    let list = PRODUCTS.slice();
    const q = (state.q || '').trim().toLowerCase();
    if (q) list = list.filter(p => (p.name + ' ' + p.short + ' ' + p.long + ' ' + p.category).toLowerCase().includes(q));
    if (state.inStockOnly) list = list.filter(p => p.inStock);
    if (state.categories.size) list = list.filter(p => state.categories.has(p.category));
    const min = (state.minPrice !== '' && !isNaN(Number(state.minPrice))) ? Number(state.minPrice) * 100 : null;
    const max = (state.maxPrice !== '' && !isNaN(Number(state.maxPrice))) ? Number(state.maxPrice) * 100 : null;
    if (min != null) list = list.filter(p => p.price >= min);
    if (max != null) list = list.filter(p => p.price <= max);
    if (state.sort === 'price-asc') list.sort((a,b)=>a.price-b.price);
    if (state.sort === 'price-desc') list.sort((a,b)=>b.price-a.price);
    if (state.sort === 'name-asc') list.sort((a,b)=>a.name.localeCompare(b.name));
    return list;
  }

  // Product card helper
  function productCardHTML(p) {
    const stockText = p.inStock ? 'In Stock' : 'Out of Stock';
    return `
      <article class="card" data-slug="${esc(p.slug)}" aria-labelledby="title-${esc(p.slug)}">
        <a href="#/product/${encodeURIComponent(p.slug)}" aria-label="${esc(p.name)}">
          <div class="img-wrap">
            ${p.sale ? `<div class="tag-sale">SALE</div>` : ''}
            <img loading="lazy" src="${esc(imgPath(p.image))}" alt="${esc(p.name)}" onerror="this.onerror=null;this.src='${DEFAULT_PLACEHOLDER}'">
          </div>
        </a>
        <div class="body">
          <h3 id="title-${esc(p.slug)}">${esc(p.name)}</h3>
          <div class="price">${money(p.price)}</div>
          <div class="small">${esc(p.short)}</div>
          <div class="small" style="text-align:center;margin-top:10px;font-weight:900;color:${p.inStock ? 'var(--accent-2)' : 'var(--muted)'}">${esc(stockText)}</div>
          <div class="actions">
            <button class="btn small" data-add="${esc(p.slug)}" aria-label="Add ${esc(p.name)} to cart">Add</button>
            <button class="btn small primary" data-buy="${esc(p.slug)}" aria-label="Buy ${esc(p.name)}">Buy</button>
          </div>
        </div>
      </article>
    `;
  }

  // Cart drawer rendering
  function renderCartDrawer() {
    const el = document.getElementById('cart-contents');
    const totalEl = document.getElementById('cart-total');
    if (!el || !totalEl) return;
    const cart = readCart();
    if (!cart || cart.length === 0) {
      el.innerHTML = `<div class="cart-empty">Your cart is empty</div>`;
      totalEl.textContent = '';
      const container = document.getElementById('paypal-cart-container');
      if (container) container.innerHTML = '';
      return;
    }

    const parts = cart.map(item => {
      const p = PRODUCTS.find(x => x.slug === item.slug);
      if (!p) return '';
      const line = money(p.price * (item.qty || 0));
      return `
        <div class="cart-item" data-slug="${esc(item.slug)}" style="display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div style="display:flex;gap:10px;align-items:center">
            <img src="${esc(imgPath(p.image))}" alt="${esc(p.name)}" style="width:56px;height:56px;object-fit:contain;border:1px solid var(--line);border-radius:8px" onerror="this.onerror=null;this.src='${DEFAULT_PLACEHOLDER}'">
            <div class="meta">
              <h4 style="margin:0;font-size:14px">${esc(p.name)}</h4>
              <p style="margin:4px 0 0;font-weight:800">${line} <span style="font-weight:600;color:var(--muted)">(${item.qty}x)</span></p>
            </div>
          </div>
          <div style="display:flex;flex-direction:column;gap:6px;align-items:flex-end">
            <button data-remove="${esc(item.slug)}" style="border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px;cursor:pointer">Remove</button>
            <div style="display:flex;gap:6px;align-items:center">
              <button data-decr="${esc(item.slug)}" style="border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px;cursor:pointer">âˆ’</button>
              <span style="min-width:24px;text-align:center">${item.qty}</span>
              <button data-incr="${esc(item.slug)}" style="border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px;cursor:pointer">ï¼‹</button>
            </div>
          </div>
        </div>
      `;
    }).join('');

    el.innerHTML = parts;

    const totalCents = cart.reduce((sum, item) => {
      const p = PRODUCTS.find(x => x.slug === item.slug);
      return sum + (p ? p.price * (item.qty || 0) : 0);
    }, 0);
    totalEl.textContent = `Total: ${money(totalCents)}`;

    // Wire cart buttons
    el.querySelectorAll('[data-remove]').forEach(btn => {
      btn.addEventListener('click', () => {
        const slug = btn.getAttribute('data-remove');
        removeFromCart(slug);
        renderCartDrawer();
      });
    });
    el.querySelectorAll('[data-incr]').forEach(btn => {
      btn.addEventListener('click', () => {
        const slug = btn.getAttribute('data-incr');
        const cart = readCart();
        const item = cart.find(i => i.slug === slug);
        if (item) { item.qty = (item.qty || 0) + 1; saveCart(cart); renderCartDrawer(); }
      });
    });
    el.querySelectorAll('[data-decr]').forEach(btn => {
      btn.addEventListener('click', () => {
        const slug = btn.getAttribute('data-decr');
        const cart = readCart();
        const item = cart.find(i => i.slug === slug);
        if (item) {
          item.qty = (item.qty || 1) - 1;
          if (item.qty <= 0) removeFromCart(slug);
          else saveCart(cart);
          renderCartDrawer();
        }
      });
    });

    const container = document.getElementById('paypal-cart-container');
    if (container) container.innerHTML = '';
  }

  // PayPal helpers & error diagnostics
  function debugLogPayPalError(err) {
    console.error('PayPal error (detailed):', err);
    if (PAYPAL_CLIENT_ID) {
      console.warn('PayPal client-id configured (runtime). If you see NOT_AUTHORIZED (403), check app credentials and Checkout/Orders API enablement.');
    } else {
      console.warn('No PayPal client-id configured; PayPal features disabled.');
    }
  }

  async function renderPayPalHosted(containerId, hostedButtonId) {
    try {
      const ok = await loadPayPalSdk(PAYPAL_CLIENT_ID);
      if (!ok) return false;
    } catch (err) {
      console.warn('PayPal not available for hosted button', err);
      return false;
    }
    const container = document.getElementById(containerId);
    if (!container) return false;
    try {
      if (window.paypal && window.paypal.HostedButtons) {
        window.paypal.HostedButtons({ hostedButtonId }).render('#' + containerId);
        return true;
      } else {
        console.warn('HostedButtons not available on PayPal SDK');
        return false;
      }
    } catch (err) {
      console.error('HostedButtons render failed', err);
      return false;
    }
  }

  // Start hosted checkout by rendering hosted button into an offscreen temporary container and clicking it.
  async function startHostedButtonCheckout(hostedButtonId) {
    if (!PAYPAL_CLIENT_ID) {
      showToast('Hosted checkout disabled (no PayPal client id)', 'error');
      return;
    }
    try {
      await loadPayPalSdk(PAYPAL_CLIENT_ID);
    } catch (err) {
      showToast('PayPal unavailable', 'error');
      return;
    }

    const tmpId = 'paypal-hosted-tmp-' + Math.random().toString(36).slice(2,10);
    const tmp = document.createElement('div');
    tmp.id = tmpId;
    tmp.style.position = 'absolute';
    tmp.style.left = '-9999px';
    tmp.style.top = '0';
    document.body.appendChild(tmp);

    try {
      if (!window.paypal || !window.paypal.HostedButtons) throw new Error('HostedButtons not provided by SDK');
      await window.paypal.HostedButtons({ hostedButtonId }).render('#' + tmpId);
      const btn = tmp.querySelector('button');
      if (btn) btn.click();
      setTimeout(() => tmp.remove(), 3000);
    } catch (err) {
      tmp.remove();
      debugLogPayPalError(err);
      showToast('Could not initialize PayPal hosted checkout â€” check console', 'error');
    }
  }

  // Product single-item checkout using PayPal Buttons
  async function startPayPalProductCheckout(product, qty = 1) {
    if (!PAYPAL_CLIENT_ID) {
      showToast('PayPal checkout disabled (no client id configured)', 'error');
      return;
    }
    try {
      await loadPayPalSdk(PAYPAL_CLIENT_ID);
    } catch (err) {
      showToast('PayPal not available. Try again later.', 'error');
      return;
    }

    const modal = document.getElementById('paypal-modal');
    const info = document.getElementById('paypal-modal-info');
    const buttonsContainer = document.getElementById('paypal-modal-buttons');
    if (!modal || !buttonsContainer) { showToast('Checkout UI not available', 'error'); return; }

    buttonsContainer.innerHTML = '';
    info.textContent = `${product.name} â€” ${money(product.price)} Ã— ${qty}`;

    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');

    try {
      window.paypal.Buttons({
        style: { layout: 'vertical', color: 'gold', shape: 'pill', label: 'pay' },
        createOrder: function(data, actions) {
          const value = ((product.price * qty) / 100).toFixed(2);
          return actions.order.create({
            purchase_units: [{
              amount: { value: value, currency_code: 'USD' },
              description: product.name
            }]
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(details) {
            closePaypalModal();
            clearCart();
            renderCartDrawer();
            showToast('Payment complete â€” Thank you!', 'success');
            // optionally navigate to a success page or display an order summary
          });
        },
        onError: function(err) {
          console.error('PayPal product checkout error', err);
          if (err && (err.name === 'NOT_AUTHORIZED' || (err.status && Number(err.status) === 403))) {
            debugLogPayPalError(err);
            showToast('PayPal NOT_AUTHORIZED â€” check client-id / app permissions (see console)', 'error');
          } else {
            showToast('PayPal checkout error', 'error');
          }
        },
        onCancel: function() {
          showToast('Payment cancelled', 'info');
          closePaypalModal();
        }
      }).render('#paypal-modal-buttons');
    } catch (err) {
      console.error('Failed to render PayPal Buttons in modal', err);
      debugLogPayPalError(err);
      showToast('Could not initialize PayPal checkout. Please try again.', 'error');
      closePaypalModal();
    }
  }

  function closePaypalModal() {
    const modal = document.getElementById('paypal-modal');
    const buttonsContainer = document.getElementById('paypal-modal-buttons');
    if (buttonsContainer) buttonsContainer.innerHTML = '';
    if (modal) {
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden', 'true');
    }
  }

  // Cart-level PayPal checkout (itemized)
  async function startPayPalCartCheckout() {
    const cart = readCart();
    if (!cart || cart.length === 0) { showToast('Cart is empty', 'info'); return; }
    if (!PAYPAL_CLIENT_ID) { showToast('PayPal checkout disabled (no client id configured)', 'error'); return; }

    try { await loadPayPalSdk(PAYPAL_CLIENT_ID); } catch (err) { showToast('PayPal not available', 'error'); return; }

    const items = [];
    let itemTotal = 0.00;
    for (const ci of cart) {
      const p = PRODUCTS.find(x => x.slug === ci.slug);
      if (!p) continue;
      const qty = Number(ci.qty || 1);
      const unit = Number(p.price) / 100;
      items.push({
        name: String(p.name).slice(0,127),
        sku: String(p.slug),
        unit_amount: { currency_code: 'USD', value: unit.toFixed(2) },
        quantity: String(qty)
      });
      itemTotal += unit * qty;
    }
    if (items.length === 0) { showToast('No valid items in cart', 'error'); return; }

    const totalStr = itemTotal.toFixed(2);
    const container = document.getElementById('paypal-cart-container');
    if (!container) { showToast('Cart payment area not found', 'error'); return; }

    container.innerHTML = `<div style="margin-bottom:8px;color:var(--muted);font-weight:700">Pay securely with PayPal</div><div id="paypal-cart-buttons"></div>`;
    const target = document.getElementById('paypal-cart-buttons');

    try {
      window.paypal.Buttons({
        style: { layout: 'vertical', color: 'gold', shape: 'pill', label: 'pay' },
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: { currency_code: 'USD', value: totalStr, breakdown: { item_total: { currency_code: 'USD', value: totalStr } } },
              items: items
            }],
            application_context: { shipping_preference: 'NO_SHIPPING' }
          });
        },
        onApprove: function(data, actions) {
          return actions.order.capture().then(function() {
            clearCart();
            renderCartDrawer();
            showToast('Payment complete â€” Thank you!', 'success');
          });
        },
        onError: function(err) {
          console.error('PayPal cart error', err);
          if (err && (err.name === 'NOT_AUTHORIZED' || (err.status && Number(err.status) === 403))) {
            debugLogPayPalError(err);
            showToast('PayPal NOT_AUTHORIZED â€” check client-id / app permissions (see console)', 'error');
          } else showToast('PayPal error', 'error');
        },
        onCancel: function() { showToast('Payment cancelled', 'info'); }
      }).render('#paypal-cart-buttons');
    } catch (err) {
      console.error('Failed to render PayPal cart buttons', err);
      debugLogPayPalError(err);
      showToast('Unable to initialize PayPal cart checkout', 'error');
    }
  }

  // Router & renderers
  const app = document.getElementById('app');

  function setActiveNav() {
    const hash = location.hash || '#/';
    document.querySelectorAll('[data-nav]').forEach(a => a.classList.remove('active'));
    if (hash.startsWith('#/shop') || hash === '#/' || hash === '#') {
      const shop = document.querySelector('[data-nav="shop"]');
      if (shop) shop.classList.add('active');
    }
    if (hash.startsWith('#/learn') || hash.startsWith('#/about')) {
      const learn = document.querySelector('[data-nav="learn"]');
      if (learn) learn.classList.add('active');
    }
    if (hash.startsWith('#/knowledge')) {
      const k = document.querySelector('[data-nav="knowledge"]');
      if (k) k.classList.add('active');
    }
    if (hash.startsWith('#/faq') || hash.startsWith('#/contact')) {
      const contact = document.querySelector('[data-nav="contact"]');
      if (contact) contact.classList.add('active');
    }
    if (hash.startsWith('#/product/')) {
      const shop = document.querySelector('[data-nav="shop"]');
      if (shop) shop.classList.add('active');
    }
  }

  function renderHome() {
    app.innerHTML = `
      <section class="hero">
        <div class="wrap">
          <div>
            <div class="kicker">RESEARCH USE ONLY</div>
            <h1>High-purity compounds for laboratory research</h1>
            <p>Glacier BioLabs supplies analytical-grade peptides and laboratory supplies for controlled, non-clinical research. All products are intended for research purposes only â€” not for human or veterinary use.</p>
            <div style="margin-top:18px">
              <a class="btn primary" href="#/shop" role="button">Browse Peptides</a>
              <a class="btn ghost" href="#/learn" role="button" style="margin-left:8px">Learn More</a>
            </div>
            <div class="badge" style="margin-top:18px;background:rgba(255,255,255,.12);padding:10px;border-radius:999px;color:#fff;display:inline-block">Free standard shipping over $150</div>
          </div>
          <div>
            <div style="background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:16px;color:#fff">
              <strong>Fast, discreet shipping</strong>
              <small style="display:block;margin-top:6px;opacity:.9">Orders are packaged for laboratory shipments and include required documentation where applicable.</small>
            </div>
            <div style="height:14px"></div>
            <div style="background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);border-radius:12px;padding:16px;color:#fff">
              <strong>Verified quality</strong>
              <small style="display:block;margin-top:6px;opacity:.9">Analytical certificates and lot information available on request for research use.</small>
            </div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="wrap">
          <h2>Featured products</h2>
          <div class="subhead">Top picks for lab workflows and analytical studies.</div>
          <div class="grid" id="featured-grid" style="margin-top:18px">
            ${PRODUCTS.slice(0,4).map(p => productCardHTML(p)).join('')}
          </div>
        </div>
      </section>
    `;
  }

  function renderShop() {
    const categories = Array.from(new Set(PRODUCTS.map(p => p.category))).sort();
    const list = filterAndSortProducts();
    app.innerHTML = `
      <section class="section">
        <div class="wrap catalog">
          <aside class="filters" id="filters" aria-label="Filters">
            <div class="filter-block">
              <h3>Search</h3>
              <div style="display:flex;gap:8px">
                <input id="filter-q" type="search" placeholder="Search products..." value="${esc(state.q || '')}" style="width:100%;padding:10px;border:1px solid var(--line);border-radius:10px">
              </div>
            </div>

            <div class="filter-block">
              <h3>Availability</h3>
              <label class="check"><input id="filter-instock" type="checkbox" ${state.inStockOnly ? 'checked' : ''}> In stock only</label>
            </div>

            <div class="filter-block">
              <h3>Category</h3>
              ${categories.map(cat => `<label class="check"><input type="checkbox" data-cat="${esc(cat)}" ${state.categories.has(cat) ? 'checked' : ''}> ${esc(cat)}</label>`).join('')}
            </div>

            <div class="filter-block">
              <h3>Price</h3>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
                <input id="filter-min" type="number" min="0" placeholder="Min $" value="${esc(state.minPrice || '')}" style="padding:10px;border:1px solid var(--line);border-radius:10px">
                <input id="filter-max" type="number" min="0" placeholder="Max $" value="${esc(state.maxPrice || '')}" style="padding:10px;border:1px solid var(--line);border-radius:10px">
                <button id="filter-apply" class="btn small">Apply</button>
                <button id="filter-clear" class="btn small">Clear</button>
              </div>
            </div>
          </aside>

          <div>
            <div class="catalog-head" style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px">
              <div>
                <div style="font-weight:900;font-size:22px">Catalog</div>
                <div class="count">${list.length} products</div>
              </div>
              <div class="sort" style="display:flex;align-items:center;gap:10px">
                <label style="font-weight:800;color:var(--muted);margin-right:6px">Sort</label>
                <select id="sort-select" style="padding:10px;border:1px solid var(--line);border-radius:12px">
                  <option value="default" ${state.sort === 'default' ? 'selected' : ''}>Featured</option>
                  <option value="price-asc" ${state.sort === 'price-asc' ? 'selected' : ''}>Price: Low to High</option>
                  <option value="price-desc" ${state.sort === 'price-desc' ? 'selected' : ''}>Price: High to Low</option>
                  <option value="name-asc" ${state.sort === 'name-asc' ? 'selected' : ''}>Name</option>
                </select>
              </div>
            </div>

            <div class="grid" id="catalog-grid">
              ${list.map(p => productCardHTML(p)).join('')}
            </div>
          </div>
        </div>
      </section>
    `;

    // Wire up filter controls
    const qEl = document.getElementById('filter-q');
    if (qEl) qEl.addEventListener('input', (e) => { state.q = e.target.value; });

    const instock = document.getElementById('filter-instock');
    if (instock) instock.addEventListener('change', (e) => { state.inStockOnly = e.target.checked; rerenderShopGrid(); });

    document.querySelectorAll('[data-cat]').forEach(ch => {
      ch.addEventListener('change', () => {
        const cat = ch.getAttribute('data-cat');
        if (ch.checked) state.categories.add(cat);
        else state.categories.delete(cat);
        rerenderShopGrid();
      });
    });

    document.getElementById('filter-apply').addEventListener('click', () => {
      state.minPrice = document.getElementById('filter-min').value;
      state.maxPrice = document.getElementById('filter-max').value;
      rerenderShopGrid();
    });
    document.getElementById('filter-clear').addEventListener('click', () => {
      state.minPrice = '';
      state.maxPrice = '';
      state.q = '';
      state.inStockOnly = false;
      state.categories = new Set();
      document.getElementById('filter-min').value = '';
      document.getElementById('filter-max').value = '';
      document.getElementById('filter-q').value = '';
      document.querySelectorAll('[data-cat]').forEach(ch => ch.checked = false);
      document.getElementById('filter-instock').checked = false;
      rerenderShopGrid();
    });
    document.getElementById('sort-select').addEventListener('change', (e) => {
      state.sort = e.target.value;
      rerenderShopGrid();
    });
  }

  function rerenderShopGrid() {
    const grid = document.getElementById('catalog-grid');
    if (!grid) return;
    const list = filterAndSortProducts();
    grid.innerHTML = list.map(p => productCardHTML(p)).join('');
  }

  function renderProduct(slug) {
    const p = PRODUCTS.find(x => x.slug === slug);
    if (!p) {
      app.innerHTML = `<div class="wrap"><h2>Product not found</h2><p class="muted">We could not find the requested product.</p></div>`;
      return;
    }

    const hostedContainerId = p.hostedButtonId ? ('product-paypal-hosted-' + encodeURIComponent(p.slug)) : '';

    app.innerHTML = `
      <section class="section">
        <div class="wrap">
          <div class="crumbs"><a class="backlink" href="#/shop">Catalog</a> â€º <span style="font-weight:900">${esc(p.name)}</span></div>

          <div class="product-page">
            <div class="media">
              <img loading="lazy" src="${esc(imgPath(p.image))}" alt="${esc(p.name)}" onerror="this.onerror=null;this.src='${DEFAULT_PLACEHOLDER}'">
            </div>

            <div class="pinfo">
              <h1>${esc(p.name)}</h1>
              <div class="rating-row">
                <div style="font-weight:900;color:var(--accent-2)">${money(p.price)}</div>
                <div class="muted" style="font-weight:700">${esc(p.category)}</div>
                <div class="muted" style="font-weight:700">${p.inStock ? 'In stock' : 'Out of stock'}</div>
              </div>
              <div class="desc">${esc(p.long)}</div>

              <div class="ruo">Research Use Only â€” Not for human or veterinary use.</div>

              <div class="form">
                <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
                  <div style="max-width:120px">
                    <label for="qty" style="display:block;font-size:13px;color:var(--muted);font-weight:800;margin-bottom:6px">Qty</label>
                    <select id="qty">
                      <option value="1">1</option><option value="2">2</option><option value="5">5</option>
                    </select>
                  </div>
                  <div style="flex:1">
                    <div style="display:flex;gap:8px;align-items:center">
                      <button id="add-to-cart" class="btn" type="button">Add to cart</button>
                      <button id="buy-now" class="btn primary" type="button" ${p.hostedButtonId ? 'style="display:none"' : ''}>Buy now</button>
                    </div>
                  </div>
                </div>
                <div class="order-help muted" style="margin-top:8px">Orders are processed via PayPal. Documentation available for research orders.</div>
                <div id="${hostedContainerId}" style="margin-top:8px"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    `;

    // Add-to-cart handler
    document.getElementById('add-to-cart').addEventListener('click', () => {
      const qty = Number(document.getElementById('qty').value) || 1;
      addToCart(p.slug, qty);
      renderCartDrawer();
    });

    if (!p.hostedButtonId) {
      const bn = document.getElementById('buy-now');
      if (bn) bn.addEventListener('click', () => {
        const qty = Number(document.getElementById('qty').value) || 1;
        startPayPalProductCheckout(p, qty);
      });
    } else {
      // Render hosted button; if not available, show fallback button
      renderPayPalHosted(hostedContainerId, p.hostedButtonId).then(ok => {
        if (!ok) {
          const bn = document.getElementById('buy-now');
          if (bn) {
            bn.style.display = '';
            bn.addEventListener('click', () => {
              const qty = Number(document.getElementById('qty').value) || 1;
              startPayPalProductCheckout(p, qty);
            });
          }
        }
      });
    }
  }

  // Policy pages (kept as static strings for clarity)
  const POLICY_PAGES = {
    terms: {
      title: 'Terms & Conditions',
      body: `
        <p>By accessing or purchasing from Glacier BioLabs, you agree to the following terms and conditions.</p>
        <p>All products sold by Glacier BioLabs are intended strictly for laboratory research and analytical purposes only. Products are not intended for human or veterinary use, consumption, injection, diagnosis, treatment, or prevention of any disease.</p>
        <p>Glacier BioLabs does not provide medical advice, dosing instructions, or usage guidance of any kind. No medical or health claims are made regarding any product sold.</p>
        <p>Buyers are solely responsible for ensuring compliance with all applicable local, state, federal, and international laws and regulations related to the purchase, possession, and use of research materials.</p>
        <p>Glacier BioLabs reserves the right to refuse service, cancel orders, or limit quantities at our discretion.</p>
      `
    },
    privacy: {
      title: 'Privacy Policy',
      body: `
        <p>Glacier BioLabs respects your privacy.</p>
        <p>We collect limited personal information necessary to process orders and provide customer support, including name, email address, shipping address, and order details.</p>
        <p>Payments are securely processed by third-party payment providers such as PayPal. Glacier BioLabs does not store or have access to your full payment information.</p>
      `
    },
    refunds: {
      title: 'Refund & Returns',
      body: `
        <p>Due to the nature of laboratory research materials, all sales are final.</p>
        <p>Refunds or replacements may be considered only in cases where an item arrives damaged or incorrect. Any issues must be reported within 48 hours of delivery by contacting <a href="mailto:glacierbiolabs@outlook.com">glacierbiolabs@outlook.com</a>.</p>
      `
    },
    shipping: {
      title: 'Shipping Policy',
      body: `
        <p>Orders are typically processed within 1â€“2 business days.</p>
        <p>Shipping is currently available within the United States unless otherwise stated.</p>
      `
    },
    disclaimer: {
      title: 'Research Use Only Disclaimer',
      body: `
        <p>All products sold by Glacier BioLabs are intended strictly for laboratory research and analytical use.</p>
        <p>Products are not intended for human or veterinary use, consumption, injection, diagnosis, treatment, or prevention of any condition or disease.</p>
      `
    },
    contact: {
      title: 'Contact & Support',
      body: `
        <p>All support and documentation requests should be directed to our official support address below.</p>
        <p>Email: <a href="mailto:glacierbiolabs@outlook.com">glacierbiolabs@outlook.com</a></p>
      `
    },
    about: {
      title: 'About Glacier BioLabs',
      body: `
        <p>Glacier BioLabs is a supplier of laboratory research materials focusing on peptides and analytical reagents.</p>
      `
    },
    knowledge: {
      title: 'Knowledge & Resources',
      body: `
        <p>High-level guidance for safe, compliant handling of research materials. This content is not a protocol and does not provide clinical instructions.</p>
      `
    },
    safety: {
      title: 'Safety & Compliance',
      body: `
        <p>Glacier BioLabs sells products exclusively for laboratory research and analytical use.</p>
      `
    }
  };

  function renderPolicy(slug) {
    const page = POLICY_PAGES[slug];
    if (!page) {
      app.innerHTML = `<div class="wrap"><h2>Page not found</h2></div>`;
      return;
    }
    app.innerHTML = `
      <section class="section">
        <div class="wrap">
          <h2>${esc(page.title)}</h2>
          <div class="subhead muted">${esc(page.title)} for Glacier BioLabs</div>
          <div style="margin-top:12px;color:var(--ink)">${page.body}</div>
        </div>
      </section>
    `;
  }

  function router() {
    setActiveNav();
    const hash = location.hash || '#/';
    if (hash === '#' || hash === '#/' || hash === '') return renderHome();
    if (hash.startsWith('#/shop')) return renderShop();
    if (hash.startsWith('#/product/')) {
      const slug = decodeURIComponent(hash.replace('#/product/', '').split('?')[0]);
      return renderProduct(slug);
    }
    if (hash.startsWith('#/terms')) return renderPolicy('terms');
    if (hash.startsWith('#/privacy')) return renderPolicy('privacy');
    if (hash.startsWith('#/refunds')) return renderPolicy('refunds');
    if (hash.startsWith('#/shipping')) return renderPolicy('shipping');
    if (hash.startsWith('#/disclaimer')) return renderPolicy('disclaimer');
    if (hash.startsWith('#/contact') || hash.startsWith('#/faq')) return renderPolicy('contact');
    if (hash.startsWith('#/about') || hash.startsWith('#/learn')) return renderPolicy('about');
    if (hash.startsWith('#/knowledge')) return renderPolicy('knowledge');
    if (hash.startsWith('#/safety')) return renderPolicy('safety');
    app.innerHTML = `<div class="wrap"><h2>Page not found</h2></div>`;
  }

  // UI wiring: drawer, cart toggle, search
  (function initUI() {
    // Branding
    const logoEl = document.getElementById('site-logo');
    if (logoEl) {
      logoEl.src = imgPath(IMAGES.logo);
      logoEl.onerror = function(){ this.style.display = 'none'; };
    }
    document.getElementById('year').textContent = new Date().getFullYear();

    // Drawer open/close with basic focus management
    const openDrawerBtn = document.getElementById('open-drawer');
    const drawer = document.getElementById('drawer');
    const backdrop = document.getElementById('drawer-backdrop');
    const closeDrawerBtn = document.getElementById('close-drawer');

    function openDrawer() {
      drawer.classList.add('open');
      backdrop.style.display = 'block';
      drawer.setAttribute('aria-hidden', 'false');
      openDrawerBtn.setAttribute('aria-expanded', 'true');
      backdrop.setAttribute('aria-hidden', 'false');
      closeDrawerBtn.focus();
    }
    function closeDrawer() {
      drawer.classList.remove('open');
      backdrop.style.display = 'none';
      drawer.setAttribute('aria-hidden', 'true');
      openDrawerBtn.setAttribute('aria-expanded', 'false');
      backdrop.setAttribute('aria-hidden', 'true');
      openDrawerBtn.focus();
    }
    openDrawerBtn && openDrawerBtn.addEventListener('click', openDrawer);
    closeDrawerBtn && closeDrawerBtn.addEventListener('click', closeDrawer);
    backdrop && backdrop.addEventListener('click', closeDrawer);

    // Cart toggle
    const cartToggle = document.getElementById('cart-toggle');
    const cartDrawer = document.getElementById('cart-drawer');
    const closeCart = document.getElementById('close-cart');
    cartToggle.addEventListener('click', () => {
      const isOpen = cartDrawer.classList.toggle('open');
      cartDrawer.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
      cartToggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
      if (isOpen) {
        renderCartDrawer();
        // move focus to close button
        closeCart.focus();
      }
    });
    closeCart.addEventListener('click', () => {
      cartDrawer.classList.remove('open');
      cartDrawer.setAttribute('aria-hidden', 'true');
      cartToggle.setAttribute('aria-expanded', 'false');
      cartToggle.focus();
    });

    // Checkout / clear
    document.getElementById('checkout-from-cart').addEventListener('click', startPayPalCartCheckout);
    document.getElementById('clear-cart').addEventListener('click', () => {
      if (confirm('Clear entire cart?')) { clearCart(); renderCartDrawer(); }
    });

    // PayPal modal close
    document.getElementById('paypal-modal-close').addEventListener('click', closePaypalModal);

    // Global handler for Add / Buy (delegation)
    document.body.addEventListener('click', (ev) => {
      const add = ev.target.closest('[data-add]');
      const buy = ev.target.closest('[data-buy]');
      if (add) {
        ev.preventDefault();
        const slug = add.getAttribute('data-add');
        addToCart(slug, 1);
        renderCartDrawer();
      } else if (buy) {
        ev.preventDefault();
        const slug = buy.getAttribute('data-buy');
        const prod = PRODUCTS.find(p => p.slug === slug);
        if (!prod) return;
        if (prod.hostedButtonId && PAYPAL_CLIENT_ID) {
          startHostedButtonCheckout(prod.hostedButtonId);
        } else {
          // navigate to product page so user sees visible checkout
          location.hash = '#/product/' + encodeURIComponent(slug);
        }
      }
    });

    // Search handling
    const searchForm = document.getElementById('search-form');
    searchForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const q = document.getElementById('q').value || '';
      state.q = q;
      location.hash = '#/shop';
      setTimeout(() => {
        const qinput = document.getElementById('filter-q');
        if (qinput) qinput.value = q;
        rerenderShopGrid();
      }, 60);
    });

    // Hash router
    window.addEventListener('hashchange', () => { router(); setActiveNav(); });
    window.addEventListener('load', () => {
      router();
      renderCartBadge();
    });

    // Expose small debug API
    window.Glacier = {
      PRODUCTS, addToCart, readCart, clearCart, startPayPalProductCheckout, startPayPalCartCheckout, startHostedButtonCheckout
    };
  })();
  </script>
</body>
</html>